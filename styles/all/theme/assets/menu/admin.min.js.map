{"version":3,"sources":["menu/admin.min.js"],"names":["$","window","document","undefined","ready","ajaxUrl","menuId","lang","dButtons","menuAdmin","dialogConfirmDelete","currentMenuTitle","Twig","extendFunction","value","ajaxSend","event","xhr","settings","url","indexOf","iconPicker","selector","onSelect","item","iconClass","id","parentsUntil","parent","attr","substring","treeBuilder","item_icon","menuDivObj","on","e","this","children","removeClass","addClass","preventDefault","element","prev","find","text","inlineMenuForm","show","appendTo","val","focus","select","end","dialog","buttons","hide","editForm","dialogEdit","dialogConfirm","click","slideToggle","button","getJSON","data","html","title","edit","remove","append","submit","trigger","focusout","menuTitle","post","menu","name","resp","up","down","next","length","location","reload","cancel","autoOpen","modal","width","jQuery"],"mappings":"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","file":"admin.min.js","sourcesContent":[";(function($, window, document, undefined) {\n\t'use strict';\n\n\t$(document).ready(function() {\n\t\tvar ajaxUrl = window.ajaxUrl || '';\n\t\tvar menuId = window.menuId || 0;\n\t\tvar lang = window.lang || {};\n\t\tvar Twig = window.Twig || {};\n\n\t\tvar dButtons = {};\n\t\tvar menuAdmin = {};\n\t\tvar dialogConfirmDelete = {};\n\t\tvar currentMenuTitle = '';\n\n\t\tTwig.extendFunction('lang', function(value) {\n\t\t\treturn (typeof lang[value] !== 'undefined') ? lang[value] : value;\n\t\t});\n\n\t\t// add menu id to ajax requests\n\t\t$(document).ajaxSend(function(event, xhr, settings) {\n\t\t\tsettings.url += (settings.url.indexOf('?') >= 0) ? '&' : '?';\n\t\t\tsettings.url += 'menu_id=' + menuId;\n\t\t});\n\n\t\t// Init icon picker\n\t\t$('.items-list').iconPicker({\n\t\t\tselector: '.icon-select',\n\t\t\tonSelect: function(item, iconClass) {\n\t\t\t\tvar id = item.parentsUntil('li').parent().attr('id').substring(5);\n\t\t\t\tmenuAdmin.treeBuilder('updateItem', {'item_icon': iconClass}, id);\n\t\t\t}\n\t\t});\n\n\t\t// menu list\n\t\tvar menuDivObj = $('#sm-menus')\n\t\t\t.on('click', '.menu-option', function(e) {\n\t\t\t\tmenuId = +$(this).parent().attr('id').substring(5);\n\t\t\t\t$(this).parent().parent().children().removeClass('row3 current-menu');\n\t\t\t\t$(this).parent().addClass('row3 current-menu');\n\t\t\t\tmenuAdmin.treeBuilder('getItems');\n\t\t\t\te.preventDefault();\n\t\t\t})\n\t\t\t.on('click', '.menu-edit', function(e) {\n\t\t\t\tvar element = $(this).parent().prev().removeClass('menu-option').parent().removeClass('current-menu').find('.menu-editable');\n\t\t\t\tcurrentMenuTitle = element.text();\n\t\t\t\tinlineMenuForm.show().appendTo(element.text('')).children(':input').val(currentMenuTitle).focus().select().end();\n\t\t\t\te.preventDefault();\n\t\t\t})\n\t\t\t.on('click', '.menu-delete', function(e) {\n\t\t\t\tdialogConfirmDelete.dialog({buttons: dButtons}).dialog('open');\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\tvar inlineMenuForm = $('<form id=\"inline-menu-form\"><input type=\"text\" id=\"inline-menu-edit\" value=\"\" /></form>').hide().appendTo($('body'));\n\n\t\t// manage menu items\n\t\tmenuAdmin = $('#nested-tree').treeBuilder({\n\t\t\tajaxUrl: ajaxUrl,\n\t\t\teditForm: '#edit-menu-item-form',\n\t\t\tdialogEdit: '#dialog-edit-menu-item',\n\t\t\tdialogConfirm: '#dialog-confirm-menu-item'\n\t\t});\n\n\t\t$('.toggle-view').click(function(e) {\n\t\t\t$($(this).attr('href')).slideToggle();\n\t\t\te.preventDefault();\n\t\t});\n\n\t\t// add new menu\n\t\t$('#add-menu').button().click(function(e) {\n\t\t\tmenuId = 0;\n\t\t\t$.getJSON(ajaxUrl + 'add_menu', function(data) {\n\t\t\t\tif (data.id === null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tmenuId = data.id;\n\n\t\t\t\tvar html = '<li id=\"menu-' + menuId + '\" class=\"row3 current-menu\">';\n\t\t\t\thtml += '<a href=\"#\" class=\"menu-option\"><span class=\"menu-editable\">' + data.title + '</span></a>';\n\t\t\t\thtml += '<div class=\"menu-actions\">';\n\t\t\t\thtml += '<a href=\"#\" class=\"menu-edit left\" title=\"' + lang.edit + '\"><span class=\"ui-icon ui-icon-gear\"></span></a>';\n\t\t\t\thtml += '<a href=\"#\" class=\"menu-delete left\" title=\"' + lang.remove + '\"><span class=\"ui-icon ui-icon-trash\"></span></a>';\n\t\t\t\thtml += '</span></li>';\n\t\t\t\tmenuDivObj.children('li').removeClass('row3 current-menu');\n\t\t\t\tmenuDivObj.append(html);\n\n\t\t\t\tmenuAdmin.show().treeBuilder('getItems');\n\t\t\t});\n\n\t\t\te.preventDefault();\n\t\t});\n\n\t\t$('#inline-menu-form').submit(function(e) {\n\t\t\te.preventDefault();\n\t\t\t$(this).children('#inline-menu-edit').trigger('blur');\n\t\t});\n\n\t\t$('#inline-menu-edit').focusout(function(e) {\n\t\t\tvar menuTitle = $(this).val();\n\t\t\tvar element = $(this).val('').parent().parent();\n\n\t\t\tif (menuId && menuTitle && menuTitle !== currentMenuTitle) {\n\t\t\t\t$.post(ajaxUrl + 'edit_menu', {'title': menuTitle}, function(menu) {\n\t\t\t\t\tif (menu.name) {\n\t\t\t\t\t\telement.text(menu.name);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tmenuTitle = currentMenuTitle;\n\t\t\t}\n\n\t\t\tinlineMenuForm.hide().appendTo($('body'));\n\t\t\telement.text(menuTitle).parent().addClass('menu-option').parent().addClass('current-menu');\n\t\t\te.preventDefault();\n\t\t});\n\n\t\tdButtons[lang.remove] = function() {\n\t\t\tif (menuId) {\n\t\t\t\t$.getJSON(ajaxUrl + 'delete_menu', function(resp) {\n\t\t\t\t\tif (resp.id === menuId) {\n\t\t\t\t\t\tvar menu = $('#menu-' + menuId);\n\t\t\t\t\t\tvar up = menu.prev();\n\t\t\t\t\t\tvar down = menu.next();\n\n\t\t\t\t\t\tif (up.length) {\n\t\t\t\t\t\t\tup.find('.menu-option').trigger('click');\n\t\t\t\t\t\t} else if (down.length) {\n\t\t\t\t\t\t\tdown.find('.menu-option').trigger('click');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.location.reload(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmenu.remove();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t$(this).dialog('close');\n\t\t};\n\n\t\tdButtons[lang.cancel] = function() {\n\t\t\t$(this).dialog('close');\n\t\t};\n\n\t\tdialogConfirmDelete = $('#dialog-confirm-menu').dialog({\n\t\t\tautoOpen: false,\n\t\t\tmodal: true,\n\t\t\twidth: 'auto',\n\t\t\tshow: 'slide',\n\t\t\thide: 'slide'\n\t\t});\n\n\t\tif (menuId) {\n\t\t\tmenuAdmin.show();\n\t\t}\n\t});\n})(jQuery, window, document);"]}