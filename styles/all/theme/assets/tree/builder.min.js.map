{"version":3,"sources":["tree/builder.min.js"],"names":["$","window","document","undefined","lang","twig","widget","options","ajaxUrl","loadSpeed","primaryKey","listType","noNesting","nestedList","editForm","noItems","addBtn","addBulkBtn","saveBtn","deleteSelBtn","rebuildBtn","selectAll","loading","ajaxMessage","itemTemplate","actionClass","selectItemClass","iconSelectClass","dialogEdit","dialogConfirm","loaded","updated","_create","self","this","eButtons","dButtons","sButtons","element","addClass","find","nestedSortable","disableNesting","forcePlaceholderSize","handle","helper","items","opacity","placeholder","tabSize","tolerance","toleranceElement","errorClass","update","itemsChanged","button","deleteChildNodes","itemID","remove","dialog","_saveTree","deleteNode","o","children","length","parent","append","html","cancel","editNode","_checkRequired","_updateItem","dialogID","parentsUntil","_resetActions","defDialog","autoOpen","modal","width","show","hide","msgObj","ajaxError","showMessage","errorMessage","loader","ajaxStart","fadeIn","ajaxStop","fadeOut","selectAllObj","click","prop","checked","events","numSelected","event","_makeEditable","target","_processEditable","preventDefault","trigger","action","currentTarget","data","_getItemId","_populateForm","buttons","extend","_on","icons","primary","addItem","text","pos","offset","height","form","toggleClass","blur","next","slideToggle","top","left","hasClass","none","_getOptions","val","buttonset","add_list","parent_id","_addBulk","param","disabled","addBtnOffset","id","getItems","_saveItem","updateItem","getJSON","empty","_showActions","_addToTree","message","delay","post","resp","error","callback","item","shift","changeMe","parentObj","_renderItem","appendTo","effect","direction","mode","apply","_trigger","response","each","required","insertAfter","attr","substring","list","padding","i","title","option","editing","editor","editorVal","replaceWith","focus","select","get","populate","e","field","_undoEditable","slideUp","_scrollTo","_refreshItem","itemsCount","tree","fromHeight","offsetTop","totalScroll","animate","scrollTop","ref","render","replacement","v","serializeArray","jQuery"],"mappings":"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","file":"tree/builder.min.js","sourcesContent":["/*!\n * Sitemaker treeBuilder\n * Author: @blitze\n * Licensed under the GPL license\n */\n\n;(function($, window, document, undefined) {\n\t'use strict';\n\n\tvar lang = window.lang || {};\n\tvar twig = window.twig || {};\n\n\t$.widget('sitemaker.treeBuilder', {\n\t\toptions: {\n\t\t\tajaxUrl: '',\n\t\t\tloadSpeed: 10,\n\t\t\tprimaryKey: 'item_id',\n\n\t\t\tlistType: 'ol',\n\t\t\tnoNesting: '.no-nest',\n\t\t\tnestedList: '#sortable',\n\t\t\teditForm: '#edit-form',\n\t\t\tnoItems: '#no-items',\n\n\t\t\taddBtn: '#add-new',\n\t\t\taddBulkBtn: '#add-bulk',\n\t\t\tsaveBtn: '#save',\n\t\t\tdeleteSelBtn: '#delete-selected',\n\t\t\trebuildBtn: '#rebuild-tree',\n\n\t\t\tselectAll: '#select-all',\n\t\t\tloading: '#loading',\n\t\t\tajaxMessage: '#ajax-message',\n\t\t\titemTemplate: '#item-template',\n\t\t\tactionClass: '.item-action',\n\t\t\tselectItemClass: '.select-item',\n\t\t\ticonSelectClass: '.icon-select',\n\n\t\t\tdialogEdit: '#dialog-edit',\n\t\t\tdialogConfirm: '#dialog-confirm',\n\n\t\t\tloaded: function() {},\n\t\t\tupdated: function() {}\n\t\t},\n\n\t\t_create: function() {\n\t\t\tvar self = this;\n\t\t\tvar eButtons = {};\n\t\t\tvar dButtons = {};\n\t\t\tvar sButtons = {};\n\n\t\t\t// call nested sortable\n\t\t\tthis.nestedList = this.element.addClass('tree-builder').find(this.options.nestedList).nestedSortable({\n\t\t\t\tdisableNesting: this.options.noNesting,\n\t\t\t\tforcePlaceholderSize: true,\n\t\t\t\tlistType: this.options.listType,\n\t\t\t\thandle: 'div',\n\t\t\t\thelper:\t'clone',\n\t\t\t\titems: 'li',\n\t\t\t\topacity: 0.6,\n\t\t\t\tplaceholder: 'placeholder',\n\t\t\t\ttabSize: 25,\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\ttoleranceElement: '> div',\n\t\t\t\terrorClass: this.options.ajaxMessage,\n\t\t\t\tupdate: function() {\n\t\t\t\t\tself.itemsChanged = true;\n\t\t\t\t\tif (self.saveBtn.button('option', 'disabled')) {\n\t\t\t\t\t\tself.saveBtn.button('option', 'disabled', false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// register dialogs\n\t\t\tdButtons[lang.deleteChildNodes] = function() {\n\t\t\t\t$('li#item-' + self.itemID).remove();\n\t\t\t\t$(this).dialog('close');\n\t\t\t\tself._saveTree();\n\t\t\t};\n\n\t\t\tdButtons[lang.deleteNode] = function() {\n\t\t\t\tvar o = $('#item-' + self.itemID);\n\t\t\t\tif (o.children(self.options.listType).length) {\n\t\t\t\t\to.parent(self.options.listType).parent('li').append('<' + self.options.listType + '>' + o.children(self.options.listType).html() + '</' + self.options.listType + '>');\n\t\t\t\t}\n\t\t\t\to.remove();\n\t\t\t\t$(this).dialog('close');\n\t\t\t\tself._saveTree();\n\t\t\t};\n\n\t\t\tdButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\teButtons[lang.editNode] = function() {\n\t\t\t\tif (self._checkRequired()) {\n\t\t\t\t\tif (self.itemID) {\n\t\t\t\t\t\tself._updateItem(self.itemID);\n\t\t\t\t\t}\n\t\t\t\t\t$(this).dialog('close');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\teButtons[lang.cancel] = function() {\n\t\t\t\t$(self.dialogID).dialog('close');\n\t\t\t};\n\n\t\t\tsButtons[lang.deleteNode] = function() {\n\t\t\t\tself.element.find(self.options.selectItemClass + ':checked').parentsUntil('li').parent().remove();\n\t\t\t\tself._saveTree();\n\t\t\t\t$(this).dialog('close');\n\n\t\t\t\tif (self.nestedList.find('li').length === 0) {\n\t\t\t\t\tself._resetActions();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tsButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tvar defDialog = {\n\t\t\t\tautoOpen: false,\n\t\t\t\tmodal: true,\n\t\t\t\twidth: 'auto',\n\t\t\t\tshow: 'slide',\n\t\t\t\thide: 'slide'\n\t\t\t};\n\n\t\t\t$(this.options.dialogEdit).dialog(defDialog);\n\t\t\t$(this.options.dialogConfirm).dialog(defDialog);\n\n\t\t\t// register events\n\t\t\tthis.msgObj = this.element.find(this.options.ajaxMessage).ajaxError(function() {\n\t\t\t\tself.showMessage(lang.errorMessage);\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\tvar loader = this.element.find(this.options.loading);\n\t\t\t$(document).ajaxStart(function() {\n\t\t\t\tloader.fadeIn();\n\t\t\t}).ajaxStop(function() {\n\t\t\t\tloader.fadeOut();\n\t\t\t});\n\n\t\t\tthis.selectAllObj = this.element.find(this.options.selectAll).click(function() {\n\t\t\t\tself.nestedList.find(self.options.selectItemClass).prop('checked', this.checked);\n\t\t\t\tif (this.checked) {\n\t\t\t\t\tself.deleteSelBtn.button('enable');\n\t\t\t\t} else {\n\t\t\t\t\tself.deleteSelBtn.button('disable');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar events = {};\n\t\t\tevents['click' + this.options.selectItemClass] = function() {\n\t\t\t\tvar numSelected = this.element.find(this.options.selectItemClass + ':checked').length;\n\t\t\t\tif (numSelected > 0) {\n\t\t\t\t\tthis.deleteSelBtn.button('enable');\n\t\t\t\t} else {\n\t\t\t\t\tthis.deleteSelBtn.button('disable');\n\t\t\t\t}\n\t\t\t\tif (numSelected === this.element.find(this.options.selectItemClass).length) {\n\t\t\t\t\tthis.selectAllObj.prop('checked', true);\n\t\t\t\t} else {\n\t\t\t\t\tthis.selectAllObj.prop('checked', false);\n\t\t\t\t}\n\t\t\t};\n\t\t\tevents['click.editable'] = function(event) {\n\t\t\t\tthis._makeEditable($(event.target));\n\t\t\t};\n\t\t\tevents['blur#inline-edit'] = function(event) {\n\t\t\t\tthis._processEditable($(event.target));\n\t\t\t};\n\t\t\tevents['submit#inline-form'] = function(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\t$(event.target).find('#inline-edit').trigger('blur');\n\t\t\t};\n\t\t\tevents['click' + this.options.actionClass] = function(event) {\n\t\t\t\tvar action = $(event.currentTarget).data('action');\n\n\t\t\t\tthis.itemID = self._getItemId($(event.currentTarget));\n\n\t\t\t\tswitch (action) {\n\t\t\t\t\tcase 'edit':\n\t\t\t\t\t\tthis.dialogID = this.options.dialogEdit;\n\t\t\t\t\t\tthis._populateForm(this.itemID);\n\t\t\t\t\t\t$(this.dialogID).dialog({buttons: eButtons}).dialog('option', 'title', lang.editNode).dialog('open');\n\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'delete':\n\t\t\t\t\t\tvar buttons = $.extend({}, dButtons);\n\n\t\t\t\t\t\tthis.dialogID = this.options.dialogConfirm;\n\n\t\t\t\t\t\tif ($('#item-' + this.itemID).children(this.options.listType).children('li').length < 1) {\n\t\t\t\t\t\t\tdelete buttons[lang.deleteChildNodes];\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$(this.dialogID).dialog({buttons: buttons}).dialog('open');\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._on(this.document, events);\n\n\t\t\t// set button events\n\t\t\tthis.addBtn = this.element.find(this.options.addBtn).button({\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-plus'\n\t\t\t\t}\n\t\t\t}).click(function(event) {\n\t\t\t\tself.addItem();\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.addBulkBtn = this.element.find(this.options.addBulkBtn).button({\n\t\t\t\ttext: false,\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-triangle-1-s'\n\t\t\t\t}\n\t\t\t}).click(function(event) {\n\t\t\t\tvar pos = $(event.target).offset();\n\t\t\t\tvar height = $(event.target).height();\n\t\t\t\tvar form = $(event.currentTarget).toggleClass('dropped').blur().parent().next().slideToggle().offset({\n\t\t\t\t\ttop: pos.top + height + 5,\n\t\t\t\t\tleft: pos.left - 167\n\t\t\t\t});\n\n\t\t\t\tif ($(event.currentTarget).hasClass('dropped') === true) {\n\t\t\t\t\tvar options = '<option value=\"0\">' + lang.none + '</option>';\n\t\t\t\t\tform.find('select').html(self._getOptions(self.nestedList, '', options)).next().val();\n\t\t\t\t}\n\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.addBulkBtn.parent().buttonset().show().next().hide().find('#cancel').click(function() {\n\t\t\t\tself.addBulkBtn.trigger('click');\n\t\t\t}).next().click(function(event) {\n\t\t\t\tvar form = $(event.target).parentsUntil('form').parent();\n\t\t\t\tvar data = {\n\t\t\t\t\t'add_list': form.find('#add_list').val(),\n\t\t\t\t\t'parent_id': form.find('#parent_id').val()\n\t\t\t\t};\n\t\t\t\tself._addBulk($.param(data));\n\t\t\t\tself.addBulkBtn.trigger('click');\n\t\t\t\tform.find('textarea').val('');\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.rebuildBtn = this.element.find(this.options.rebuildBtn).button({\n\t\t\t\tdisabled: true,\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-refresh'\n\t\t\t\t}\n\t\t\t}).click(function(event) {\n\t\t\t\tself._saveTree();\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.deleteSelBtn = this.element.find(this.options.deleteSelBtn).button({\n\t\t\t\tdisabled: true,\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-trash'\n\t\t\t\t}\n\t\t\t}).click(function(event) {\n\t\t\t\tself.dialogID = self.options.dialogConfirm;\n\t\t\t\t$(self.dialogID).dialog({buttons: sButtons}).dialog('open');\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.saveBtn = this.element.find(this.options.saveBtn).button({\n\t\t\t\tdisabled: true,\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-check'\n\t\t\t\t}\n\t\t\t}).click(function(event) {\n\t\t\t\tif (self.itemsChanged === true) {\n\t\t\t\t\tself._saveTree();\n\t\t\t\t}\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.addBtnOffset = this.addBtn.offset();\n\t\t\tthis.noItems = this.element.find(this.options.noItems);\n\t\t\tthis.editForm = $(this.options.editForm);\n\n\t\t\ttwig({\n\t\t\t\tid: 'item_template',\n\t\t\t\tdata: this.element.find(this.options.itemTemplate).html()\n\t\t\t});\n\n\t\t\tthis.getItems();\n\t\t},\n\n\t\taddItem: function() {\n\t\t\tthis._saveItem('add_item', {});\n\t\t},\n\n\t\tupdateItem: function(data, id) {\n\t\t\tthis._saveItem('update_item', data, id);\n\t\t},\n\n\t\tgetItems: function() {\n\t\t\tvar self = this;\n\n\t\t\t$.getJSON(this.options.ajaxUrl + 'load_items', function(data) {\n\t\t\t\tself.nestedList.empty();\n\t\t\t\tself._resetActions();\n\n\t\t\t\tif (data.items !== undefined && data.items.length > 0) {\n\t\t\t\t\tself._showActions();\n\t\t\t\t\tself._addToTree(data.items);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tshowMessage: function(message) {\n\t\t\tif (message) {\n\t\t\t\tthis.msgObj.text(message);\n\t\t\t\tthis.msgObj.fadeIn().delay(3000).fadeOut();\n\t\t\t}\n\t\t},\n\n\t\t_addBulk: function(data) {\n\t\t\tvar self = this;\n\t\t\t$.post(this.options.ajaxUrl + 'add_bulk', data,\n\t\t\t\tfunction(resp) {\n\t\t\t\t\tif (!resp.error) {\n\t\t\t\t\t\tself._showActions();\n\t\t\t\t\t\tself._addToTree(resp.items);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.showMessage(resp.error);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'json'\n\t\t\t);\n\t\t},\n\n\t\t_addToTree: function(items, callback) {\n\t\t\t/* jshint sub: true */\n\t\t\tif (items.length > 0) {\n\t\t\t\tvar html = {};\n\t\t\t\tvar item = items.shift();\n\n\t\t\t\titem['item_title'] = (item['item_title']) ? item['item_title'] : lang.changeMe;\n\n\t\t\t\tif (item['parent_id'] > 0) {\n\t\t\t\t\tvar parentObj = $('#item-' + item['parent_id']);\n\t\t\t\t\tvar children = parentObj.children(this.options.listType);\n\n\t\t\t\t\tif (children.length === 0) {\n\t\t\t\t\t\thtml = $('<' + this.options.listType + '>' + this._renderItem(item) + '</' + this.options.listType + '>').hide();\n\t\t\t\t\t\thtml.appendTo(parentObj);\n\t\t\t\t\t} else {\n\t\t\t\t\t\thtml = $(this._renderItem(item)).hide();\n\t\t\t\t\t\thtml.appendTo(parentObj.children(this.options.listType));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\thtml = $(this._renderItem(item)).hide();\n\t\t\t\t\thtml.appendTo(this.nestedList);\n\t\t\t\t}\n\n\t\t\t\tvar self = this;\n\t\t\t\thtml.effect('slide', {'direction': 'right', 'mode': 'show'}, this.options.loadSpeed, function() {\n\t\t\t\t\tself._addToTree(items, callback);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (callback !== undefined) {\n\t\t\t\tcallback.apply(this, [items]);\n\t\t\t}\n\t\t\tthis._trigger('loaded', null, {items: items});\n\t\t},\n\n\t\t_checkRequired: function() {\n\t\t\t$(this.dialogID + ' .error').remove();\n\n\t\t\tvar response = true;\n\n\t\t\t$(this.dialogID + ' .required').each(function() {\n\t\t\t\tif (!$(this).val()) {\n\t\t\t\t\t$('<div class=\"error\">' + lang.required + '</div>').insertAfter(this);\n\t\t\t\t\tresponse = false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn response;\n\t\t},\n\n\t\t_getItemId: function(element) {\n\t\t\treturn element.attr('id').substring(5);\n\t\t},\n\n\t\t_getOptions: function(list, padding, options) {\n\t\t\tvar self = this;\n\n\t\t\tlist.children('li').each(function(i, element) {\n\t\t\t\tvar item = $(element);\n\t\t\t\tvar id = self._getItemId(element);\n\t\t\t\tvar title = padding + '&#x251c;&#x2500; ' + item.find('.editable:first').text();\n\t\t\t\tvar option = '<option value=\"' + id + '\">' + title + '</option>';\n\n\t\t\t\toptions += self._getOptions(item.children('ol'), '&nbsp;&nbsp;&nbsp;&nbsp;' + padding, option);\n\t\t\t});\n\n\t\t\treturn options;\n\t\t},\n\n\t\t_makeEditable: function(element) {\n\t\t\tif (this.editing === true) {\n\t\t\t\tthis.editor.trigger('blur');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.editing = true;\n\t\t\tthis.editorVal = (element.text() !== lang.changeMe) ? element.text() : '';\n\n\t\t\telement.replaceWith('<form id=\"inline-form\"><input type=\"text\" id=\"inline-edit\" value=\"' + this.editorVal + '\" /></form>');\n\t\t\tthis.editor = $('#inline-edit').data('field', element.data('field')).focus().select();\n\t\t},\n\n\t\t_populateForm: function(id) {\n\t\t\tvar self = this;\n\t\t\t$.get(this.options.ajaxUrl + 'load_item?item_id=' + id, function(data) {\n\t\t\t\tself.showMessage(data.message);\n\t\t\t\tself.editForm.populate(data);\n\t\t\t}, 'json');\n\n\t\t\treturn {};\n\t\t},\n\n\t\t_processEditable: function(e) {\n\t\t\tif (this.editing === false) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar id = this._getItemId($(e).parentsUntil('li').parent());\n\t\t\tvar field = $(e).data('field');\n\t\t\tvar val = $(e).val();\n\t\t\tvar data = {};\n\n\t\t\tif (id && field && val && val !== this.editorVal) {\n\t\t\t\tdata[field] = val;\n\t\t\t\tdata.field = field;\n\t\t\t\tthis._saveItem('update_item', data, id, field);\n\t\t\t} else {\n\t\t\t\tthis._undoEditable(this.editorVal ? this.editorVal : lang.changeMe);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t_resetActions: function() {\n\t\t\tthis.noItems.show();\n\t\t\tthis.nestedList.hide();\n\t\t\tthis.addBulkBtn.parent().next().slideUp();\n\t\t\tthis.selectAllObj.prop('checked', false).parent().hide();\n\t\t\tthis.deleteSelBtn.button('disable').hide();\n\t\t\tthis.rebuildBtn.button('disable').hide();\n\t\t\tthis.saveBtn.button('disable').hide();\n\t\t},\n\n\t\t_saveItem: function(mode, data, id, field) {\n\t\t\tvar self = this;\n\t\t\t$.post(this.options.ajaxUrl + mode + ((id) ? '?item_id=' + id : ''), data,\n\t\t\t\tfunction(resp) {\n\t\t\t\t\tif (!resp.error) {\n\t\t\t\t\t\tswitch (mode) {\n\t\t\t\t\t\t\tcase 'add_item':\n\t\t\t\t\t\t\t\tself._addToTree([resp], function() {\n\t\t\t\t\t\t\t\t\tvar element = $('#item-' + resp[self.options.primaryKey]);\n\n\t\t\t\t\t\t\t\t\tself._showActions();\n\t\t\t\t\t\t\t\t\tself._scrollTo(element, self.addBtnOffset.top, function() {\n\t\t\t\t\t\t\t\t\t\telement.find('.editable').trigger('click');\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'update_item':\n\t\t\t\t\t\t\t\tif (self.editing) {\n\t\t\t\t\t\t\t\t\tself._undoEditable(resp[field]);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tself._refreshItem(resp);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'save_item':\n\t\t\t\t\t\t\t\tvar element = self._refreshItem(resp);\n\t\t\t\t\t\t\t\tself._trigger('updated', null, element);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.showMessage(resp.error);\n\n\t\t\t\t\t\tif (self.editing) {\n\t\t\t\t\t\t\tself._undoEditable(self.editorVal);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'json'\n\t\t\t);\n\t\t},\n\n\t\t_saveTree: function() {\n\t\t\tvar data = this.nestedList.nestedSortable('toArray');\n\t\t\tvar itemsCount = data.length;\n\n\t\t\tthis._saveItem('save_tree', {\n\t\t\t\t'tree': data\n\t\t\t});\n\n\t\t\tthis.itemsChanged = false;\n\t\t\tthis.saveBtn.button('option', 'disabled', true);\n\t\t\tthis.deleteSelBtn.button('option', 'disabled', true);\n\n\t\t\tif (itemsCount > 0) {\n\t\t\t\tthis.noItems.hide();\n\t\t\t} else {\n\t\t\t\tthis.noItems.show();\n\t\t\t}\n\t\t},\n\n\t\t_scrollTo: function(element, fromHeight, callback) {\n\t\t\tvar offset = element.offset();\n\t\t\tvar offsetTop = offset.top;\n\t\t\tvar totalScroll = offsetTop - fromHeight;\n\n\t\t\tthis.nestedList.animate({\n\t\t\t\tscrollTop: totalScroll\n\t\t\t}, 1000, callback);\n\t\t},\n\n\t\t_showActions: function() {\n\t\t\tthis.noItems.hide();\n\t\t\tthis.nestedList.show();\n\t\t\tthis.selectAllObj.parent().show();\n\t\t\tthis.deleteSelBtn.show();\n\t\t\tthis.saveBtn.show();\n\t\t\tthis.rebuildBtn.button('enable').show();\n\t\t},\n\n\t\t_renderItem: function(data) {\n\t\t\treturn twig({ref: 'item_template'}).render(data);\n\t\t},\n\n\t\t_refreshItem: function(data) {\n\t\t\tvar replacement = $(this._renderItem(data)).children();\n\t\t\treturn $('#item-' + data[this.options.primaryKey]).children(':first').replaceWith(replacement);\n\t\t},\n\n\t\t_undoEditable: function(v) {\n\t\t\tthis.editorVal = '';\n\t\t\tthis.editing = false;\n\t\t\tthis.editor.parent().replaceWith('<span class=\"editable\" data-field=\"' + this.editor.data('field') + '\">' + v + '</span>');\n\t\t},\n\n\t\t_updateItem: function(itemID) {\n\t\t\tthis._saveItem('save_item', this.editForm.serializeArray(), itemID);\n\t\t}\n\t});\n})(jQuery, window, document);"],"sourceRoot":"/source/"}