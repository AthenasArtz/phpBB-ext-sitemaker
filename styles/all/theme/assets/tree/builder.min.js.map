{"version":3,"sources":["tree/builder.min.js"],"names":["$","window","document","undefined","lang","Twig","widget","options","ajaxUrl","loadSpeed","primaryKey","listType","noNesting","nestedList","editForm","noItems","addBtn","addBulkBtn","addBulkList","saveBtn","deleteSelBtn","rebuildBtn","selectAll","loading","ajaxMessage","itemTemplate","actionClass","selectItemClass","iconSelectClass","dialogEdit","dialogConfirm","loaded","updated","_create","self","this","eButtons","dButtons","sButtons","codeMirror","element","addClass","find","nestedSortable","disableNesting","forcePlaceholderSize","handle","helper","items","opacity","placeholder","tabSize","tolerance","toleranceElement","errorClass","update","itemsChanged","button","deleteChildNodes","node","itemID","_removeNode","dialog","_saveTree","deleteNode","children","length","appendTo","parent","cancel","saveNode","_checkRequired","_submitForm","dialogID","parentsUntil","each","_resetActions","defDialog","autoOpen","modal","width","show","hide","msgObj","loader","ajaxStart","fadeIn","ajaxStop","fadeOut","ajaxComplete","event","xhr","responseJSON","message","showMessage","ajaxError","errorMessage","onbeforeunload","e","returnValue","unsavedChanges","selectAllObj","click","prop","checked","events","numSelected","_makeEditable","target","_processEditable","preventDefault","trigger","action","currentTarget","data","_getItemId","_populateForm","buttons","editNode","extend","_on","icons","primary","populate","addNode","addItem","text","pos","offset","height","form","toggleClass","blur","next","slideToggle","top","left","hasClass","none","html","_getOptions","val","buttonset","add_list","getValue","parent_id","setValue","clearHistory","_addBulk","param","disabled","addBtnOffset","twig","id","CodeMirror","fromTextArea","get","theme","lineNumbers","lineWrapping","autoRefresh","styleActiveLine","fixedGutter","indentUnit","coverGutterNextToScrollbar","tabMode","extraKeys","Tab","cm","spaces","Array","getOption","join","replaceSelection","getItems","_saveItem","updateItem","getJSON","empty","_showActions","_addToTree","delay","post","resp","error","callback","item","shift","changeMe","parentObj","_renderItem","effect","direction","mode","apply","_trigger","remove","response","required","insertAfter","attr","substring","list","padding","i","option","editing","editorVal","replaceWith","editor","focus","select","callBack","field","_undoEditable","slideUp","_scrollTo","_refreshItem","itemsCount","tree","fromHeight","totalScroll","animate","scrollTop","siblings","ref","render","replacement","v","serializeArray","jQuery"],"mappings":"CAMC,SAAUA,EAAGC,EAAQC,EAAUC,GAC/B,aAEA,IAAIC,EAAOH,EAAOG,SACdC,EAAOJ,EAAOI,SAElBL,EAAEM,OAAO,yBACRC,SACCC,QAAS,GACTC,UAAW,GACXC,WAAY,UAEZC,SAAU,KACVC,UAAW,WACXC,WAAY,YACZC,SAAU,aACVC,QAAS,YAETC,OAAQ,WACRC,WAAY,YACZC,YAAa,YACbC,QAAS,QACTC,aAAc,mBACdC,WAAY,gBAEZC,UAAW,cACXC,QAAS,WACTC,YAAa,gBACbC,aAAc,iBACdC,YAAa,eACbC,gBAAiB,eACjBC,gBAAiB,eAEjBC,WAAY,eACZC,cAAe,kBAEfC,OAAQ,aACRC,QAAS,cAGVC,QAAS,WACR,IAAIC,EAAOC,KACPC,KACAC,KACAC,KACAC,KAGJJ,KAAKtB,WAAasB,KAAKK,QAAQC,SAAS,gBAAgBC,KAAKP,KAAK5B,QAAQM,YAAY8B,gBACrFC,eAAgBT,KAAK5B,QAAQK,UAC7BiC,sBAAsB,EACtBlC,SAAUwB,KAAK5B,QAAQI,SACvBmC,OAAQ,MACRC,OAAQ,QACRC,MAAO,KACPC,QAAS,GACTC,YAAa,cACbC,QAAS,GACTC,UAAW,UACXC,iBAAkB,QAClBC,WAAYnB,KAAK5B,QAAQiB,YACzB+B,OAAQ,WACPrB,EAAKsB,cAAe,EAChBtB,EAAKf,QAAQsC,OAAO,SAAU,aACjCvB,EAAKf,QAAQsC,OAAO,SAAU,YAAY,MAM7CpB,EAASjC,EAAKsD,kBAAoB,WACjC,IAAIC,EAAO3D,EAAE,WAAakC,EAAK0B,QAC/B1B,EAAK2B,YAAYF,GACjB3D,EAAEmC,MAAM2B,OAAO,SACf5B,EAAK6B,aAGN1B,EAASjC,EAAK4D,YAAc,WAC3B,IAAIL,EAAO3D,EAAE,WAAakC,EAAK0B,QAC3BD,EAAKM,SAAS/B,EAAK3B,QAAQI,UAAUuD,QACxCP,EAAKM,SAAS/B,EAAK3B,QAAQI,UAAUsD,SAAS,MAAME,SAASR,EAAKS,OAAOlC,EAAK3B,QAAQI,WAEvFuB,EAAK2B,YAAYF,GACjB3D,EAAEmC,MAAM2B,OAAO,SACf5B,EAAK6B,aAGN1B,EAASjC,EAAKiE,QAAU,WACvBrE,EAAEmC,MAAM2B,OAAO,UAGhB1B,EAAShC,EAAKkE,UAAY,WACrBpC,EAAKqC,mBACRrC,EAAKsC,YAAYtC,EAAK0B,QACtB5D,EAAEmC,MAAM2B,OAAO,WAIjB1B,EAAShC,EAAKiE,QAAU,WACvBrE,EAAEkC,EAAKuC,UAAUX,OAAO,UAGzBxB,EAASlC,EAAK4D,YAAc,WAC3B9B,EAAKM,QAAQE,KAAKR,EAAK3B,QAAQoB,gBAAkB,YAAY+C,aAAa,MAAMN,SAASO,KAAK,WAC7FzC,EAAK2B,YAAY7D,EAAEmC,SAEpBD,EAAK6B,YACL/D,EAAEmC,MAAM2B,OAAO,SAE2B,IAAtC5B,EAAKrB,WAAW6B,KAAK,MAAMwB,QAC9BhC,EAAK0C,iBAIPtC,EAASlC,EAAKiE,QAAU,WACvBrE,EAAEmC,MAAM2B,OAAO,UAGhB,IAAIe,GACHC,UAAU,EACVC,OAAO,EACPC,MAAO,OACPC,KAAM,QACNC,KAAM,SAGPlF,EAAEmC,KAAK5B,QAAQsB,YAAYiC,OAAOe,GAClC7E,EAAEmC,KAAK5B,QAAQuB,eAAegC,OAAOe,GAGrC1C,KAAKgD,OAAShD,KAAKK,QAAQE,KAAKP,KAAK5B,QAAQiB,aAE7C,IAAI4D,EAASjD,KAAKK,QAAQE,KAAKP,KAAK5B,QAAQgB,SAC5CvB,EAAEE,GAAUmF,UAAU,WACrBD,EAAOE,WACLC,SAAS,WACXH,EAAOI,YACLC,aAAa,SAASC,EAAOC,GAC3BA,EAAIC,cAEHD,EAAIC,aAAaC,SACpB3D,EAAK4D,YAAYH,EAAIC,aAAaC,WAGlCE,UAAU,WACZ7D,EAAK4D,YAAY1F,EAAK4F,gBAGvB/F,EAAOgG,eAAiB,SAASC,GAChC,IAA0B,IAAtBhE,EAAKsB,aAOR,OANA0C,EAAIA,GAAKjG,EAAOyF,SAGfQ,EAAEC,YAAc/F,EAAKgG,gBAGfhG,EAAKgG,gBAIdjE,KAAKkE,aAAelE,KAAKK,QAAQE,KAAKP,KAAK5B,QAAQe,WAAWgF,MAAM,WACnEpE,EAAKrB,WAAW6B,KAAKR,EAAK3B,QAAQoB,iBAAiB4E,KAAK,UAAWpE,KAAKqE,SACpErE,KAAKqE,QACRtE,EAAKd,aAAaqC,OAAO,UAEzBvB,EAAKd,aAAaqC,OAAO,aAI3B,IAAIgD,KACJA,EAAO,QAAUtE,KAAK5B,QAAQoB,iBAAmB,WAChD,IAAI+E,EAAcvE,KAAKK,QAAQE,KAAKP,KAAK5B,QAAQoB,gBAAkB,YAAYuC,OAC3EwC,EAAc,EACjBvE,KAAKf,aAAaqC,OAAO,UAEzBtB,KAAKf,aAAaqC,OAAO,WAEtBiD,IAAgBvE,KAAKK,QAAQE,KAAKP,KAAK5B,QAAQoB,iBAAiBuC,OACnE/B,KAAKkE,aAAaE,KAAK,WAAW,GAElCpE,KAAKkE,aAAaE,KAAK,WAAW,IAGpCE,EAAO,kBAAoB,SAASf,GACnCvD,KAAKwE,cAAc3G,EAAE0F,EAAMkB,UAE5BH,EAAO,oBAAsB,SAASf,GACrCvD,KAAK0E,iBAAiB7G,EAAE0F,EAAMkB,UAE/BH,EAAO,sBAAwB,SAASf,GACvCA,EAAMoB,iBACN9G,EAAE0F,EAAMkB,QAAQlE,KAAK,gBAAgBqE,QAAQ,SAE9CN,EAAO,QAAUtE,KAAK5B,QAAQmB,aAAe,SAASgE,GACrD,IAAIsB,EAAShH,EAAE0F,EAAMuB,eAAeC,KAAK,UAIzC,OAFA/E,KAAKyB,OAAS1B,EAAKiF,WAAWnH,EAAE0F,EAAMuB,gBAE9BD,GACP,IAAK,OACJ7E,KAAKsC,SAAWtC,KAAK5B,QAAQsB,WAC7BM,KAAKiF,cAAcjF,KAAKyB,OAAQ,SAASa,GACxCzE,EAAEyE,GAAUX,QAAQuD,QAASjF,IAAW0B,OAAO,SAAU,QAAS1D,EAAKkH,UAAUxD,OAAO,UAE1F,MACA,IAAK,SACJ,IAAIuD,EAAUrH,EAAEuH,UAAWlF,GAE3BF,KAAKsC,SAAWtC,KAAK5B,QAAQuB,cAEzB9B,EAAE,SAAWmC,KAAKyB,QAAQK,SAAS9B,KAAK5B,QAAQI,UAAUsD,SAAS,MAAMC,OAAS,UAC9EmD,EAAQjH,EAAKsD,kBAErB1D,EAAEmC,KAAKsC,UAAUX,QAAQuD,QAASA,IAAUvD,OAAO,UAKtD3B,KAAKqF,IAAIrF,KAAKjC,SAAUuG,GAGxBtE,KAAKnB,OAASmB,KAAKK,QAAQE,KAAKP,KAAK5B,QAAQS,QAAQyC,QACpDgE,OACCC,QAAS,kBAERpB,MAAM,SAASZ,GACjBA,EAAMoB,iBACF5E,EAAK3B,QAAQsB,WAAWqC,QAC3BhC,EAAK0B,YApOT,EAqOI1B,EAAKuC,SAAWvC,EAAK3B,QAAQsB,WAC7BK,EAAKpB,SAAS6G,aACd3H,EAAEkC,EAAKuC,UAAUX,QAAQuD,QAASjF,IAAW0B,OAAO,SAAU,QAAS1D,EAAKwH,SAAS9D,OAAO,SAE5F5B,EAAK2F,YAIP1F,KAAKlB,WAAakB,KAAKK,QAAQE,KAAKP,KAAK5B,QAAQU,YAAYwC,QAC5DqE,MAAM,EACNL,OACCC,QAAS,0BAERpB,MAAM,SAASZ,GACjB,IAAIqC,EAAM/H,EAAE0F,EAAMkB,QAAQoB,SACtBC,EAASjI,EAAE0F,EAAMkB,QAAQqB,SACzBC,EAAOlI,EAAE0F,EAAMuB,eAAekB,YAAY,WAAWC,OAAOhE,SAASiE,OAAOC,cAAcN,QAC7FO,IAAKR,EAAIQ,IAAMN,EAAS,EACxBO,KAAMT,EAAIS,KAAO,MAGlB,IAAmD,IAA/CxI,EAAE0F,EAAMuB,eAAewB,SAAS,WAAqB,CACxD,IAAIlI,EAAU,qBAAuBH,EAAKsI,KAAO,YACjDR,EAAKxF,KAAK,UAAUiG,KAAKzG,EAAK0G,YAAY1G,EAAKrB,WAAY,GAAIN,IAAU8H,OAAOQ,MAGjFnD,EAAMoB,mBAGP3E,KAAKlB,WAAWmD,SAAS0E,YAAY7D,OAAOoD,OAAOnD,OAAOxC,KAAK,WAAW4D,MAAM,WAC/EpE,EAAKjB,WAAW8F,QAAQ,WACtBsB,OAAO/B,MAAM,SAASZ,GACxB,IAAIwC,EAAOlI,EAAE0F,EAAMkB,QAAQlC,aAAa,QAAQN,SAC5C8C,GACH6B,SAAYxG,EAAWyG,WACvBC,UAAaf,EAAKxF,KAAK,cAAcmG,OAItCtG,EAAW2G,SAAS,IACpB3G,EAAW4G,eAEXjH,EAAKkH,SAASpJ,EAAEqJ,MAAMnC,IACtBhF,EAAKjB,WAAW8F,QAAQ,SACxBrB,EAAMoB,mBAGP3E,KAAKd,WAAac,KAAKK,QAAQE,KAAKP,KAAK5B,QAAQc,YAAYoC,QAC5D6F,UAAU,EACV7B,OACCC,QAAS,qBAERpB,MAAM,SAASZ,GACjBxD,EAAK6B,YACL2B,EAAMoB,mBAGP3E,KAAKf,aAAee,KAAKK,QAAQE,KAAKP,KAAK5B,QAAQa,cAAcqC,QAChE6F,UAAU,EACV7B,OACCC,QAAS,mBAERpB,MAAM,SAASZ,GACjBxD,EAAKuC,SAAWvC,EAAK3B,QAAQuB,cAC7B9B,EAAEkC,EAAKuC,UAAUX,QAAQuD,QAAS/E,IAAWwB,OAAO,QACpD4B,EAAMoB,mBAGP3E,KAAKhB,QAAUgB,KAAKK,QAAQE,KAAKP,KAAK5B,QAAQY,SAASsC,QACtD6F,UAAU,EACV7B,OACCC,QAAS,mBAERpB,MAAM,SAASZ,IACS,IAAtBxD,EAAKsB,cACRtB,EAAK6B,YAEN2B,EAAMoB,mBAGP3E,KAAKoH,aAAepH,KAAKnB,OAAOgH,SAChC7F,KAAKpB,QAAUoB,KAAKK,QAAQE,KAAKP,KAAK5B,QAAQQ,SAC9CoB,KAAKrB,SAAWd,EAAEmC,KAAK5B,QAAQO,UAE/BT,EAAKmJ,MACJC,GAAI,gBACJvC,KAAM/E,KAAKK,QAAQE,KAAKP,KAAK5B,QAAQkB,cAAckH,SAIpDpG,EAAamH,WAAWC,aAAa3J,EAAEmC,KAAK5B,QAAQW,aAAa0I,IAAI,IACpEC,MAAO,UACPC,aAAa,EACbC,cAAe,EACfC,aAAa,EACbC,iBAAiB,EACjBC,aAAa,EACbC,WAAY,EACZC,4BAA4B,EAC5BC,QAAS,QACTC,WACCC,IAAO,SAASC,GACf,IAAIC,EAASC,MAAMF,EAAGG,UAAU,cAAgB,GAAGC,KAAK,KACxDJ,EAAGK,iBAAiBJ,OAKvBtI,KAAK2I,YAGNjD,QAAS,WACR1F,KAAK4I,UAAU,gBAGhBC,WAAY,SAAS9D,EAAMuC,GAC1BtH,KAAK4I,UAAU,cAAe7D,EAAMuC,IAGrCqB,SAAU,WACT,IAAI5I,EAAOC,KAEXnC,EAAEiL,QAAQ9I,KAAK5B,QAAQC,QAAU,aAAc,SAAS0G,GACvDhF,EAAKrB,WAAWqK,QAChBhJ,EAAK0C,qBAjWR,IAmWOsC,EAAKlE,OAAuBkE,EAAKlE,MAAMkB,OAAS,IACnDhC,EAAKiJ,eACLjJ,EAAKkJ,WAAWlE,EAAKlE,WAKxB8C,YAAa,SAASD,GACjBA,IACH1D,KAAKgD,OAAO2C,KAAKjC,GACjB1D,KAAKgD,OAAOG,SAAS+F,MAAM,KAAM7F,YAInC4D,SAAU,SAASlC,GAClB,IAAIhF,EAAOC,KACXnC,EAAEsL,KAAKnJ,KAAK5B,QAAQC,QAAU,WAAY0G,EACzC,SAASqE,GACHA,EAAKC,MAITtJ,EAAK4D,YAAYyF,EAAKC,QAHtBtJ,EAAKiJ,eACLjJ,EAAKkJ,WAAWG,EAAKvI,SAKvB,SAIFoI,WAAY,SAASpI,EAAOyI,GAE3B,GAAIzI,EAAMkB,OAAS,EAAG,CACrB,IAAIyE,KACA+C,EAAO1I,EAAM2I,QAIjB,GAFAD,EAAiB,WAAKA,EAAkB,WAAIA,EAAiB,WAAItL,EAAKwL,SAElEF,EAAgB,UAAI,EAAG,CAC1B,IAAIG,EAAY7L,EAAE,SAAW0L,EAAgB,WAGrB,IAFTG,EAAU5H,SAAS9B,KAAK5B,QAAQI,UAElCuD,QACZyE,EAAO3I,EAAE,IAAMmC,KAAK5B,QAAQI,SAAW,IAAMwB,KAAK2J,YAAYJ,GAAQ,KAAOvJ,KAAK5B,QAAQI,SAAW,KAAKuE,QACrGf,SAAS0H,IAEdlD,EAAO3I,EAAEmC,KAAK2J,YAAYJ,IAAOxG,QAC5Bf,SAAS0H,EAAU5H,SAAS9B,KAAK5B,QAAQI,gBAG/CgI,EAAO3I,EAAEmC,KAAK2J,YAAYJ,IAAOxG,QAC5Bf,SAAShC,KAAKtB,YAGpB,IAAIqB,EAAOC,KACXwG,EAAKoD,OAAO,SAAUC,UAAa,QAASC,KAAQ,QAAS9J,KAAK5B,QAAQE,UAAW,WACpFyB,EAAKkJ,WAAWpI,EAAOyI,UA1Z3B,IA8ZMA,GACHA,EAASS,MAAM/J,MAAOa,IAEvBb,KAAKgK,SAAS,SAAU,MAAOnJ,MAAOA,KAGvCuB,eAAgB,WACfvE,EAAEmC,KAAKsC,SAAW,WAAW2H,SAE7B,IAAIC,GAAW,EASf,OAPArM,EAAEmC,KAAKsC,SAAW,cAAcE,KAAK,WAC/B3E,EAAEmC,MAAM0G,QACZ7I,EAAE,sBAAwBI,EAAKkM,SAAW,UAAUC,YAAYpK,MAChEkK,GAAW,KAINA,GAGRlF,WAAY,SAAS3E,GACpB,OAAOA,EAAQgK,KAAK,MAAMC,UAAU,IAGrC7D,YAAa,SAAS8D,EAAMC,EAASpM,GACpC,IAAI2B,EAAOC,KAWX,OATAuK,EAAKzI,SAAS,MAAMU,KAAK,SAASiI,EAAGpK,GACpC,IAAIkJ,EAAO1L,EAAEwC,GAGTqK,EAAS,kBAFJ3K,EAAKiF,WAAWuE,GAEa,MAD1BiB,EAAU,oBAAsBjB,EAAKhJ,KAAK,mBAAmBoF,QACpB,YAErDvH,GAAW2B,EAAK0G,YAAY8C,EAAKzH,SAAS,MAAO,2BAA6B0I,EAASE,KAGjFtM,GAGRoG,cAAe,SAASnE,IACF,IAAjBL,KAAK2K,SAKT3K,KAAK2K,SAAU,EACf3K,KAAK4K,UAAavK,EAAQsF,SAAW1H,EAAKwL,SAAYpJ,EAAQsF,OAAS,GAEvEtF,EAAQwK,YAAY,qEAAuE7K,KAAK4K,UAAY,eAC5G5K,KAAK8K,OAASjN,EAAE,gBAAgBkH,KAAK,QAAS1E,EAAQ0E,KAAK,UAAUgG,QAAQC,UAR5EhL,KAAK8K,OAAOlG,QAAQ,SAWtBK,cAAe,SAASqC,EAAI2D,GAC3B,IAAIlL,EAAOC,KAOX,OANAnC,EAAE4J,IAAIzH,KAAK5B,QAAQC,QAAU,qBAAuBiJ,EAAI,SAASvC,GAChEhF,EAAK4D,YAAYoB,EAAKrB,SACtB3D,EAAKpB,SAAS6G,SAAST,GACvBkG,EAASlL,EAAKuC,WACZ,YAKJoC,iBAAkB,SAASX,GAC1B,IAAqB,IAAjB/D,KAAK2K,QAAT,CAIA,IAAIrD,EAAKtH,KAAKgF,WAAWnH,EAAEkG,GAAGxB,aAAa,MAAMN,UAC7CiJ,EAAQrN,EAAEkG,GAAGgB,KAAK,SAClB2B,EAAM7I,EAAEkG,GAAG2C,MACX3B,KAUJ,OARIuC,GAAM4D,GAASxE,GAAOA,IAAQ1G,KAAK4K,WACtC7F,EAAKmG,GAASxE,EACd3B,EAAKmG,MAAQA,EACblL,KAAK4I,UAAU,cAAe7D,EAAMuC,EAAI4D,IAExClL,KAAKmL,cAAcnL,KAAK4K,UAAY5K,KAAK4K,UAAY3M,EAAKwL,WAGpD,IAGRhH,cAAe,WACdzC,KAAKpB,QAAQkE,OACb9C,KAAKtB,WAAWqE,OAChB/C,KAAKlB,WAAWmD,SAASiE,OAAOkF,UAChCpL,KAAKkE,aAAaE,KAAK,WAAW,GAAOnC,SAASc,OAClD/C,KAAKf,aAAaqC,OAAO,WAAWyB,OACpC/C,KAAKd,WAAWoC,OAAO,WAAWyB,OAClC/C,KAAKhB,QAAQsC,OAAO,WAAWyB,QAGhC6F,UAAW,SAASkB,EAAM/E,EAAMuC,EAAI4D,GACnC,IAAInL,EAAOC,KACXnC,EAAEsL,KAAKnJ,KAAK5B,QAAQC,QAAUyL,GAAQ,EAAO,YAAcxC,EAAK,IAAKvC,EACpE,SAASqE,GACR,GAAKA,EAAKC,MA2BTtJ,EAAK4D,YAAYyF,EAAKC,OAElBtJ,EAAK4K,SACR5K,EAAKoL,cAAcpL,EAAK6K,gBA7BzB,OAAQd,GACP,IAAK,WACJ/J,EAAKkJ,YAAYG,GAAO,WACvB,IAAI/I,EAAUxC,EAAE,SAAWuL,EAAKrJ,EAAK3B,QAAQG,aAE7CwB,EAAKiJ,eACLjJ,EAAKsL,UAAUhL,EAASN,EAAKqH,aAAahB,IAAK,WACzCrG,EAAK3B,QAAQsB,WAAWqC,QAC5B1B,EAAQE,KAAK,aAAaqE,QAAQ,aAItC,MACA,IAAK,cACA7E,EAAK4K,QACR5K,EAAKoL,cAAc/B,EAAK8B,IAExBnL,EAAKuL,aAAalC,GAEpB,MACA,IAAK,YACJ,IAAI/I,EAAUN,EAAKuL,aAAalC,GAChCrJ,EAAKiK,SAAS,UAAW,KAAM3J,KAWnC,SAIFuB,UAAW,WACV,IAAImD,EAAO/E,KAAKtB,WAAW8B,eAAe,WACtC+K,EAAaxG,EAAKhD,OAEtB/B,KAAK4I,UAAU,aACd4C,KAAQzG,IAGT/E,KAAKqB,cAAe,EACpBrB,KAAKhB,QAAQsC,OAAO,SAAU,YAAY,GAC1CtB,KAAKf,aAAaqC,OAAO,SAAU,YAAY,GAE3CiK,EAAa,EAChBvL,KAAKpB,QAAQmE,OAEb/C,KAAKpB,QAAQkE,QAIfuI,UAAW,SAAShL,EAASoL,EAAYnC,GACxC,IAEIoC,EAFSrL,EAAQwF,SACEO,IACOqF,EAE9BzL,KAAKtB,WAAWiN,SACfC,UAAWF,GACT,IAAMpC,IAGVN,aAAc,WACbhJ,KAAKpB,QAAQmE,OACb/C,KAAKtB,WAAWoE,OAChB9C,KAAKkE,aAAajC,SAASa,OAC3B9C,KAAKf,aAAa6D,OAClB9C,KAAKhB,QAAQ8D,OACb9C,KAAKd,WAAWoC,OAAO,UAAUwB,QAGlCpB,YAAa,SAASF,GAEjBA,EAAKqK,WAAW9J,OACnBP,EAAKyI,SAGLzI,EAAKS,OAAOjC,KAAK5B,QAAQI,UAAUyL,UAIrCN,YAAa,SAAS5E,GACrB,OAAO7G,EAAKmJ,MAAMyE,IAAK,kBAAkBC,OAAOhH,IAGjDuG,aAAc,SAASvG,GACtB,IAAIiH,EAAcnO,EAAEmC,KAAK2J,YAAY5E,IAAOjD,WAC5C,OAAOjE,EAAE,SAAWkH,EAAK/E,KAAK5B,QAAQG,aAAauD,SAAS,UAAU+I,YAAYmB,IAGnFb,cAAe,SAASc,GACvBjM,KAAK4K,UAAY,GACjB5K,KAAK2K,SAAU,EACf3K,KAAK8K,OAAO7I,SAAS4I,YAAY,sCAAwC7K,KAAK8K,OAAO/F,KAAK,SAAW,KAAOkH,EAAI,YAGjH5J,YAAa,SAASZ,GACrB,IAAIoD,EAASpD,EAAS,YAAc,WACpCzB,KAAK4I,UAAU/D,EAAQ7E,KAAKrB,SAASuN,iBAAkBzK,MAxmBzD,CA2mBE0K,OAAQrO,OAAQC","file":"builder.min.js","sourcesContent":["/*!\n * Sitemaker treeBuilder\n * Author: @blitze\n * Licensed under the GPL license\n */\n\n;(function($, window, document, undefined) {\n\t'use strict';\n\n\tvar lang = window.lang || {};\n\tvar Twig = window.Twig || {};\n\n\t$.widget('sitemaker.treeBuilder', {\n\t\toptions: {\n\t\t\tajaxUrl: '',\n\t\t\tloadSpeed: 10,\n\t\t\tprimaryKey: 'item_id',\n\n\t\t\tlistType: 'ol',\n\t\t\tnoNesting: '.no-nest',\n\t\t\tnestedList: '#sortable',\n\t\t\teditForm: '#edit-form',\n\t\t\tnoItems: '#no-items',\n\n\t\t\taddBtn: '#add-new',\n\t\t\taddBulkBtn: '#add-bulk',\n\t\t\taddBulkList: '#add_list',\n\t\t\tsaveBtn: '#save',\n\t\t\tdeleteSelBtn: '#delete-selected',\n\t\t\trebuildBtn: '#rebuild-tree',\n\n\t\t\tselectAll: '#select-all',\n\t\t\tloading: '#loading',\n\t\t\tajaxMessage: '#ajax-message',\n\t\t\titemTemplate: '#item-template',\n\t\t\tactionClass: '.item-action',\n\t\t\tselectItemClass: '.select-item',\n\t\t\ticonSelectClass: '.icon-select',\n\n\t\t\tdialogEdit: '#dialog-edit',\n\t\t\tdialogConfirm: '#dialog-confirm',\n\n\t\t\tloaded: function() {},\n\t\t\tupdated: function() {}\n\t\t},\n\n\t\t_create: function() {\n\t\t\tvar self = this;\n\t\t\tvar eButtons = {};\n\t\t\tvar dButtons = {};\n\t\t\tvar sButtons = {};\n\t\t\tvar codeMirror = {};\n\n\t\t\t// call nested sortable\n\t\t\tthis.nestedList = this.element.addClass('tree-builder').find(this.options.nestedList).nestedSortable({\n\t\t\t\tdisableNesting: this.options.noNesting,\n\t\t\t\tforcePlaceholderSize: true,\n\t\t\t\tlistType: this.options.listType,\n\t\t\t\thandle: 'div',\n\t\t\t\thelper:\t'clone',\n\t\t\t\titems: 'li',\n\t\t\t\topacity: 0.6,\n\t\t\t\tplaceholder: 'placeholder',\n\t\t\t\ttabSize: 25,\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\ttoleranceElement: '> div',\n\t\t\t\terrorClass: this.options.ajaxMessage,\n\t\t\t\tupdate: function() {\n\t\t\t\t\tself.itemsChanged = true;\n\t\t\t\t\tif (self.saveBtn.button('option', 'disabled')) {\n\t\t\t\t\t\tself.saveBtn.button('option', 'disabled', false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// register dialogs\n\t\t\tdButtons[lang.deleteChildNodes] = function() {\n\t\t\t\tvar node = $('li#item-' + self.itemID);\n\t\t\t\tself._removeNode(node);\n\t\t\t\t$(this).dialog('close');\n\t\t\t\tself._saveTree();\n\t\t\t};\n\n\t\t\tdButtons[lang.deleteNode] = function() {\n\t\t\t\tvar node = $('li#item-' + self.itemID);\n\t\t\t\tif (node.children(self.options.listType).length) {\n\t\t\t\t\tnode.children(self.options.listType).children('li').appendTo(node.parent(self.options.listType));\n\t\t\t\t}\n\t\t\t\tself._removeNode(node);\n\t\t\t\t$(this).dialog('close');\n\t\t\t\tself._saveTree();\n\t\t\t};\n\n\t\t\tdButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\teButtons[lang.saveNode] = function() {\n\t\t\t\tif (self._checkRequired()) {\n\t\t\t\t\tself._submitForm(self.itemID);\n\t\t\t\t\t$(this).dialog('close');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\teButtons[lang.cancel] = function() {\n\t\t\t\t$(self.dialogID).dialog('close');\n\t\t\t};\n\n\t\t\tsButtons[lang.deleteNode] = function() {\n\t\t\t\tself.element.find(self.options.selectItemClass + ':checked').parentsUntil('li').parent().each(function() {\n\t\t\t\t\tself._removeNode($(this));\n\t\t\t\t});\n\t\t\t\tself._saveTree();\n\t\t\t\t$(this).dialog('close');\n\n\t\t\t\tif (self.nestedList.find('li').length === 0) {\n\t\t\t\t\tself._resetActions();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tsButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tvar defDialog = {\n\t\t\t\tautoOpen: false,\n\t\t\t\tmodal: true,\n\t\t\t\twidth: 'auto',\n\t\t\t\tshow: 'slide',\n\t\t\t\thide: 'slide'\n\t\t\t};\n\n\t\t\t$(this.options.dialogEdit).dialog(defDialog);\n\t\t\t$(this.options.dialogConfirm).dialog(defDialog);\n\n\t\t\t// register events\n\t\t\tthis.msgObj = this.element.find(this.options.ajaxMessage);\n\n\t\t\tvar loader = this.element.find(this.options.loading);\n\t\t\t$(document).ajaxStart(function() {\n\t\t\t\tloader.fadeIn();\n\t\t\t}).ajaxStop(function() {\n\t\t\t\tloader.fadeOut();\n\t\t\t}).ajaxComplete(function(event, xhr) {\n\t\t\t\tif (xhr.responseJSON) {\n\t\t\t\t\t// Display any returned message\n\t\t\t\t\tif (xhr.responseJSON.message) {\n\t\t\t\t\t\tself.showMessage(xhr.responseJSON.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).ajaxError(function() {\n\t\t\t\tself.showMessage(lang.errorMessage);\n\t\t\t});\n\n\t\t\twindow.onbeforeunload = function(e) {\n\t\t\t\tif (self.itemsChanged === true) {\n\t\t\t\t\te = e || window.event;\n\t\t\t\t\t// For IE and Firefox\n\t\t\t\t\tif (e) {\n\t\t\t\t\t\te.returnValue = lang.unsavedChanges;\n\t\t\t\t\t}\n\t\t\t\t\t// For Safari\n\t\t\t\t\treturn lang.unsavedChanges;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.selectAllObj = this.element.find(this.options.selectAll).click(function() {\n\t\t\t\tself.nestedList.find(self.options.selectItemClass).prop('checked', this.checked);\n\t\t\t\tif (this.checked) {\n\t\t\t\t\tself.deleteSelBtn.button('enable');\n\t\t\t\t} else {\n\t\t\t\t\tself.deleteSelBtn.button('disable');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar events = {};\n\t\t\tevents['click' + this.options.selectItemClass] = function() {\n\t\t\t\tvar numSelected = this.element.find(this.options.selectItemClass + ':checked').length;\n\t\t\t\tif (numSelected > 0) {\n\t\t\t\t\tthis.deleteSelBtn.button('enable');\n\t\t\t\t} else {\n\t\t\t\t\tthis.deleteSelBtn.button('disable');\n\t\t\t\t}\n\t\t\t\tif (numSelected === this.element.find(this.options.selectItemClass).length) {\n\t\t\t\t\tthis.selectAllObj.prop('checked', true);\n\t\t\t\t} else {\n\t\t\t\t\tthis.selectAllObj.prop('checked', false);\n\t\t\t\t}\n\t\t\t};\n\t\t\tevents['click.editable'] = function(event) {\n\t\t\t\tthis._makeEditable($(event.target));\n\t\t\t};\n\t\t\tevents['blur#inline-edit'] = function(event) {\n\t\t\t\tthis._processEditable($(event.target));\n\t\t\t};\n\t\t\tevents['submit#inline-form'] = function(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\t$(event.target).find('#inline-edit').trigger('blur');\n\t\t\t};\n\t\t\tevents['click' + this.options.actionClass] = function(event) {\n\t\t\t\tvar action = $(event.currentTarget).data('action');\n\n\t\t\t\tthis.itemID = self._getItemId($(event.currentTarget));\n\n\t\t\t\tswitch (action) {\n\t\t\t\t\tcase 'edit':\n\t\t\t\t\t\tthis.dialogID = this.options.dialogEdit;\n\t\t\t\t\t\tthis._populateForm(this.itemID, function(dialogID) {\n\t\t\t\t\t\t\t$(dialogID).dialog({buttons: eButtons}).dialog('option', 'title', lang.editNode).dialog('open');\n\t\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'delete':\n\t\t\t\t\t\tvar buttons = $.extend({}, dButtons);\n\n\t\t\t\t\t\tthis.dialogID = this.options.dialogConfirm;\n\n\t\t\t\t\t\tif ($('#item-' + this.itemID).children(this.options.listType).children('li').length < 1) {\n\t\t\t\t\t\t\tdelete buttons[lang.deleteChildNodes];\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$(this.dialogID).dialog({buttons: buttons}).dialog('open');\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis._on(this.document, events);\n\n\t\t\t// set button events\n\t\t\tthis.addBtn = this.element.find(this.options.addBtn).button({\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-plus'\n\t\t\t\t}\n\t\t\t}).click(function(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif (self.options.dialogEdit.length) {\n\t\t\t\t\tself.itemID = undefined;\n\t\t\t\t\tself.dialogID = self.options.dialogEdit;\n\t\t\t\t\tself.editForm.populate({});\n\t\t\t\t\t$(self.dialogID).dialog({buttons: eButtons}).dialog('option', 'title', lang.addNode).dialog('open');\n\t\t\t\t} else {\n\t\t\t\t\tself.addItem();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.addBulkBtn = this.element.find(this.options.addBulkBtn).button({\n\t\t\t\ttext: false,\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-triangle-1-s'\n\t\t\t\t}\n\t\t\t}).click(function(event) {\n\t\t\t\tvar pos = $(event.target).offset();\n\t\t\t\tvar height = $(event.target).height();\n\t\t\t\tvar form = $(event.currentTarget).toggleClass('dropped').blur().parent().next().slideToggle().offset({\n\t\t\t\t\ttop: pos.top + height + 5,\n\t\t\t\t\tleft: pos.left - 167\n\t\t\t\t});\n\n\t\t\t\tif ($(event.currentTarget).hasClass('dropped') === true) {\n\t\t\t\t\tvar options = '<option value=\"0\">' + lang.none + '</option>';\n\t\t\t\t\tform.find('select').html(self._getOptions(self.nestedList, '', options)).next().val();\n\t\t\t\t}\n\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.addBulkBtn.parent().buttonset().show().next().hide().find('#cancel').click(function() {\n\t\t\t\tself.addBulkBtn.trigger('click');\n\t\t\t}).next().click(function(event) {\n\t\t\t\tvar form = $(event.target).parentsUntil('form').parent();\n\t\t\t\tvar data = {\n\t\t\t\t\t'add_list': codeMirror.getValue(),\n\t\t\t\t\t'parent_id': form.find('#parent_id').val()\n\t\t\t\t};\n\n\t\t\t\t// reset codemirror\n\t\t\t\tcodeMirror.setValue(\"\");\n\t\t\t\tcodeMirror.clearHistory();\n\n\t\t\t\tself._addBulk($.param(data));\n\t\t\t\tself.addBulkBtn.trigger('click');\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.rebuildBtn = this.element.find(this.options.rebuildBtn).button({\n\t\t\t\tdisabled: true,\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-refresh'\n\t\t\t\t}\n\t\t\t}).click(function(event) {\n\t\t\t\tself._saveTree();\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.deleteSelBtn = this.element.find(this.options.deleteSelBtn).button({\n\t\t\t\tdisabled: true,\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-trash'\n\t\t\t\t}\n\t\t\t}).click(function(event) {\n\t\t\t\tself.dialogID = self.options.dialogConfirm;\n\t\t\t\t$(self.dialogID).dialog({buttons: sButtons}).dialog('open');\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.saveBtn = this.element.find(this.options.saveBtn).button({\n\t\t\t\tdisabled: true,\n\t\t\t\ticons: {\n\t\t\t\t\tprimary: 'ui-icon-check'\n\t\t\t\t}\n\t\t\t}).click(function(event) {\n\t\t\t\tif (self.itemsChanged === true) {\n\t\t\t\t\tself._saveTree();\n\t\t\t\t}\n\t\t\t\tevent.preventDefault();\n\t\t\t});\n\n\t\t\tthis.addBtnOffset = this.addBtn.offset();\n\t\t\tthis.noItems = this.element.find(this.options.noItems);\n\t\t\tthis.editForm = $(this.options.editForm);\n\n\t\t\tTwig.twig({\n\t\t\t\tid: 'item_template',\n\t\t\t\tdata: this.element.find(this.options.itemTemplate).html()\n\t\t\t});\n\n\t\t\t/* global CodeMirror */\n\t\t\tcodeMirror = CodeMirror.fromTextArea($(this.options.addBulkList).get(0), {\n\t\t\t\ttheme: \"monokai\",\n\t\t\t\tlineNumbers: true,\n\t\t\t\tlineWrapping : false,\n\t\t\t\tautoRefresh: true,\n\t\t\t\tstyleActiveLine: true,\n\t\t\t\tfixedGutter: true,\n\t\t\t\tindentUnit: 4,\n\t\t\t\tcoverGutterNextToScrollbar: false,\n\t\t\t\ttabMode: \"shift\",\n\t\t\t\textraKeys: {\n\t\t\t\t\t'Tab': function(cm) {\n\t\t\t\t\t\tvar spaces = Array(cm.getOption(\"indentUnit\") + 1).join(\" \");\n\t\t\t\t\t\tcm.replaceSelection(spaces);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.getItems();\n\t\t},\n\n\t\taddItem: function() {\n\t\t\tthis._saveItem('add_item', {});\n\t\t},\n\n\t\tupdateItem: function(data, id) {\n\t\t\tthis._saveItem('update_item', data, id);\n\t\t},\n\n\t\tgetItems: function() {\n\t\t\tvar self = this;\n\n\t\t\t$.getJSON(this.options.ajaxUrl + 'load_items', function(data) {\n\t\t\t\tself.nestedList.empty();\n\t\t\t\tself._resetActions();\n\n\t\t\t\tif (data.items !== undefined && data.items.length > 0) {\n\t\t\t\t\tself._showActions();\n\t\t\t\t\tself._addToTree(data.items);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tshowMessage: function(message) {\n\t\t\tif (message) {\n\t\t\t\tthis.msgObj.text(message);\n\t\t\t\tthis.msgObj.fadeIn().delay(3000).fadeOut();\n\t\t\t}\n\t\t},\n\n\t\t_addBulk: function(data) {\n\t\t\tvar self = this;\n\t\t\t$.post(this.options.ajaxUrl + 'add_bulk', data,\n\t\t\t\tfunction(resp) {\n\t\t\t\t\tif (!resp.error) {\n\t\t\t\t\t\tself._showActions();\n\t\t\t\t\t\tself._addToTree(resp.items);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.showMessage(resp.error);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'json'\n\t\t\t);\n\t\t},\n\n\t\t_addToTree: function(items, callback) {\n\t\t\t/* jshint sub: true */\n\t\t\tif (items.length > 0) {\n\t\t\t\tvar html = {};\n\t\t\t\tvar item = items.shift();\n\n\t\t\t\titem['item_title'] = (item['item_title']) ? item['item_title'] : lang.changeMe;\n\n\t\t\t\tif (item['parent_id'] > 0) {\n\t\t\t\t\tvar parentObj = $('#item-' + item['parent_id']);\n\t\t\t\t\tvar children = parentObj.children(this.options.listType);\n\n\t\t\t\t\tif (children.length === 0) {\n\t\t\t\t\t\thtml = $('<' + this.options.listType + '>' + this._renderItem(item) + '</' + this.options.listType + '>').hide();\n\t\t\t\t\t\thtml.appendTo(parentObj);\n\t\t\t\t\t} else {\n\t\t\t\t\t\thtml = $(this._renderItem(item)).hide();\n\t\t\t\t\t\thtml.appendTo(parentObj.children(this.options.listType));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\thtml = $(this._renderItem(item)).hide();\n\t\t\t\t\thtml.appendTo(this.nestedList);\n\t\t\t\t}\n\n\t\t\t\tvar self = this;\n\t\t\t\thtml.effect('slide', {'direction': 'right', 'mode': 'show'}, this.options.loadSpeed, function() {\n\t\t\t\t\tself._addToTree(items, callback);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (callback !== undefined) {\n\t\t\t\tcallback.apply(this, [items]);\n\t\t\t}\n\t\t\tthis._trigger('loaded', null, {items: items});\n\t\t},\n\n\t\t_checkRequired: function() {\n\t\t\t$(this.dialogID + ' .error').remove();\n\n\t\t\tvar response = true;\n\n\t\t\t$(this.dialogID + ' .required').each(function() {\n\t\t\t\tif (!$(this).val()) {\n\t\t\t\t\t$('<div class=\"error\">' + lang.required + '</div>').insertAfter(this);\n\t\t\t\t\tresponse = false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn response;\n\t\t},\n\n\t\t_getItemId: function(element) {\n\t\t\treturn element.attr('id').substring(5);\n\t\t},\n\n\t\t_getOptions: function(list, padding, options) {\n\t\t\tvar self = this;\n\n\t\t\tlist.children('li').each(function(i, element) {\n\t\t\t\tvar item = $(element);\n\t\t\t\tvar id = self._getItemId(item);\n\t\t\t\tvar title = padding + '&#x251c;&#x2500; ' + item.find('.editable:first').text();\n\t\t\t\tvar option = '<option value=\"' + id + '\">' + title + '</option>';\n\n\t\t\t\toptions += self._getOptions(item.children('ol'), '&nbsp;&nbsp;&nbsp;&nbsp;' + padding, option);\n\t\t\t});\n\n\t\t\treturn options;\n\t\t},\n\n\t\t_makeEditable: function(element) {\n\t\t\tif (this.editing === true) {\n\t\t\t\tthis.editor.trigger('blur');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.editing = true;\n\t\t\tthis.editorVal = (element.text() !== lang.changeMe) ? element.text() : '';\n\n\t\t\telement.replaceWith('<form id=\"inline-form\"><input type=\"text\" id=\"inline-edit\" value=\"' + this.editorVal + '\" /></form>');\n\t\t\tthis.editor = $('#inline-edit').data('field', element.data('field')).focus().select();\n\t\t},\n\n\t\t_populateForm: function(id, callBack) {\n\t\t\tvar self = this;\n\t\t\t$.get(this.options.ajaxUrl + 'load_item?item_id=' + id, function(data) {\n\t\t\t\tself.showMessage(data.message);\n\t\t\t\tself.editForm.populate(data);\n\t\t\t\tcallBack(self.dialogID);\n\t\t\t}, 'json');\n\n\t\t\treturn {};\n\t\t},\n\n\t\t_processEditable: function(e) {\n\t\t\tif (this.editing === false) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar id = this._getItemId($(e).parentsUntil('li').parent());\n\t\t\tvar field = $(e).data('field');\n\t\t\tvar val = $(e).val();\n\t\t\tvar data = {};\n\n\t\t\tif (id && field && val && val !== this.editorVal) {\n\t\t\t\tdata[field] = val;\n\t\t\t\tdata.field = field;\n\t\t\t\tthis._saveItem('update_item', data, id, field);\n\t\t\t} else {\n\t\t\t\tthis._undoEditable(this.editorVal ? this.editorVal : lang.changeMe);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t_resetActions: function() {\n\t\t\tthis.noItems.show();\n\t\t\tthis.nestedList.hide();\n\t\t\tthis.addBulkBtn.parent().next().slideUp();\n\t\t\tthis.selectAllObj.prop('checked', false).parent().hide();\n\t\t\tthis.deleteSelBtn.button('disable').hide();\n\t\t\tthis.rebuildBtn.button('disable').hide();\n\t\t\tthis.saveBtn.button('disable').hide();\n\t\t},\n\n\t\t_saveItem: function(mode, data, id, field) {\n\t\t\tvar self = this;\n\t\t\t$.post(this.options.ajaxUrl + mode + ((id) ? '?item_id=' + id : ''), data,\n\t\t\t\tfunction(resp) {\n\t\t\t\t\tif (!resp.error) {\n\t\t\t\t\t\tswitch (mode) {\n\t\t\t\t\t\t\tcase 'add_item':\n\t\t\t\t\t\t\t\tself._addToTree([resp], function() {\n\t\t\t\t\t\t\t\t\tvar element = $('#item-' + resp[self.options.primaryKey]);\n\n\t\t\t\t\t\t\t\t\tself._showActions();\n\t\t\t\t\t\t\t\t\tself._scrollTo(element, self.addBtnOffset.top, function() {\n\t\t\t\t\t\t\t\t\t\tif (!self.options.dialogEdit.length) {\n\t\t\t\t\t\t\t\t\t\t\telement.find('.editable').trigger('click');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'update_item':\n\t\t\t\t\t\t\t\tif (self.editing) {\n\t\t\t\t\t\t\t\t\tself._undoEditable(resp[field]);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tself._refreshItem(resp);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'save_item':\n\t\t\t\t\t\t\t\tvar element = self._refreshItem(resp);\n\t\t\t\t\t\t\t\tself._trigger('updated', null, element);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.showMessage(resp.error);\n\n\t\t\t\t\t\tif (self.editing) {\n\t\t\t\t\t\t\tself._undoEditable(self.editorVal);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'json'\n\t\t\t);\n\t\t},\n\n\t\t_saveTree: function() {\n\t\t\tvar data = this.nestedList.nestedSortable('toArray');\n\t\t\tvar itemsCount = data.length;\n\n\t\t\tthis._saveItem('save_tree', {\n\t\t\t\t'tree': data\n\t\t\t});\n\n\t\t\tthis.itemsChanged = false;\n\t\t\tthis.saveBtn.button('option', 'disabled', true);\n\t\t\tthis.deleteSelBtn.button('option', 'disabled', true);\n\n\t\t\tif (itemsCount > 0) {\n\t\t\t\tthis.noItems.hide();\n\t\t\t} else {\n\t\t\t\tthis.noItems.show();\n\t\t\t}\n\t\t},\n\n\t\t_scrollTo: function(element, fromHeight, callback) {\n\t\t\tvar offset = element.offset();\n\t\t\tvar offsetTop = offset.top;\n\t\t\tvar totalScroll = offsetTop - fromHeight;\n\n\t\t\tthis.nestedList.animate({\n\t\t\t\tscrollTop: totalScroll\n\t\t\t}, 1000, callback);\n\t\t},\n\n\t\t_showActions: function() {\n\t\t\tthis.noItems.hide();\n\t\t\tthis.nestedList.show();\n\t\t\tthis.selectAllObj.parent().show();\n\t\t\tthis.deleteSelBtn.show();\n\t\t\tthis.saveBtn.show();\n\t\t\tthis.rebuildBtn.button('enable').show();\n\t\t},\n\n\t\t_removeNode: function(node) {\n\t\t\t// if node has sibblings, remove node and leave parent\n\t\t\tif (node.siblings().length) {\n\t\t\t\tnode.remove();\n\t\t\t// if node does not have sibblings, remove parent ol/ul\n\t\t\t} else {\n\t\t\t\tnode.parent(this.options.listType).remove();\n\t\t\t}\n\t\t},\n\n\t\t_renderItem: function(data) {\n\t\t\treturn Twig.twig({ref: 'item_template'}).render(data);\n\t\t},\n\n\t\t_refreshItem: function(data) {\n\t\t\tvar replacement = $(this._renderItem(data)).children();\n\t\t\treturn $('#item-' + data[this.options.primaryKey]).children(':first').replaceWith(replacement);\n\t\t},\n\n\t\t_undoEditable: function(v) {\n\t\t\tthis.editorVal = '';\n\t\t\tthis.editing = false;\n\t\t\tthis.editor.parent().replaceWith('<span class=\"editable\" data-field=\"' + this.editor.data('field') + '\">' + v + '</span>');\n\t\t},\n\n\t\t_submitForm: function(itemID) {\n\t\t\tvar action = itemID ? 'save_item' : 'add_item';\n\t\t\tthis._saveItem(action, this.editForm.serializeArray(), itemID);\n\t\t}\n\t});\n})(jQuery, window, document);"]}