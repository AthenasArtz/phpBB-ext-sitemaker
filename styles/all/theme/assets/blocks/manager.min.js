!function(t,e,n,i){"use strict";var o="",a=!1,l=!1,s=!1,r={},c={},d={},u={},f={},p={},g={},b={},h={},m={},v={},k={},x={},C={},y={},_={},w={},j={},S=!1,U={},O={},D={},N=function(t){var e=t.length,n=t.parent().data("columns")!==i?t.parent().data("columns")<=5?t.parent().data("columns"):5:3,o=e%n,a=e-o;if(e<=n)n=e;else if(t.parent().hasClass("equal")){if(o>0&&n>3)for(var l=1;l<o;l++)if(e%(n-l)===0){n-=l;break}a=e,o=0}if(J(t),a>0&&t.slice(0,a).addClass("grid__col grid__col--1-of-"+n),o){var s=1;o<2&&(s=5,o=5),t.slice(a,e).addClass("grid__col grid__col--"+s+"-of-"+o)}},J=function(t){t.removeClass(function(){var t=this.className.match(/grid__col+(\S+)?/gi);return t?t.join(" "):""})},z=function(){r.addClass("show-position"),c.removeClass("empty-position").siblings(".grid__col").removeClass("lastUnit")},T=function(){r.removeClass("show-position"),c=t('.block-position:not(:has(".block"))').addClass("empty-position").each(function(e,n){t(n).siblings(".grid__col").last().addClass("lastUnit")})},A=function(t,e){var n="block-editor-"+e.id;O.get(n)&&(O.EditorManager.execCommand("mceFocus",!1,n),O.EditorManager.execCommand("mceRemoveEditor",!0,n)),t.html(d.render(e)),t.find("#"+n).length&&O.EditorManager.execCommand("mceAddEditor",!1,n)},E=function(e,n,i){t(i).removeAttr("role aria-disabled data-block class style").addClass("block").html('<div class="ui-state-highlight sm-block-spacing sortable" style="padding: 5px"><i class="fa fa-spinner fa-2x fa-spin"></i> '+w.ajaxLoading+"</div>");var o={block:t.trim(n),weight:i.parent().find(".block").index(i),route:j.route,ext:j.ext,position:e};t.getJSON(j.ajaxUrl+"/blocks/add_block",o,function(e){if(l=!1,""===e.id)return void t(i).remove();var n=t(i).attr("id","block-"+e.id);A(n,e),n.children().not(".block-controls").show("scale",{percent:100},1e3),l&&Q()})},M=function(e){t.getJSON(j.ajaxUrl+"/blocks/edit_block",{id:e.attr("id").substring(6)},function(e){C=e,e.form&&(g.html(e.form),g.find("#block-settings").tabs(),g.find("select[data-togglable-settings]").each(function(){var e=t(this);e.change(function(){U.toggleSelectSettings(e)}),U.toggleSelectSettings(e)}),g.dialog({buttons:v}).dialog("option","title",w.edit+" - "+e.title).dialog("open"))})},B=function(e){var n=t("#edit_form"),i=g.dialog("widget").find("#update-similar:checked").length;t.getJSON(j.ajaxUrl+"/blocks/save_block?route="+j.route+"&id="+e.attr("id").substring(6)+"&similar="+i+"&"+n.serialize(),function(e){g.dialog("close"),e.list&&t.each(e.list,function(e,n){n.content=$(n.content),A(t("#block-"+n.id),n)})})},F=function(e){return e.id!==i&&void t.post(j.ajaxUrl+"/blocks/update_block?route="+j.route,e,function(t){a===!0&&W(t.title)},"json")},P=function(e){e.id!==i&&t.getJSON(j.ajaxUrl+"/blocks/handle_custom_action",e,function(t){"function"==typeof U.ajaxCallbacks[t.callback]&&U.ajaxCallbacks[t.callback].call(i,t)})},R=function(e){t.post(j.ajaxUrl+"/blocks/set_default_route?route="+(e===!0?j.route:""))},q=function(e){t.post(j.ajaxUrl+"/blocks/set_startpage",t.param(e))},I=function(e){t.post(j.ajaxUrl+"/blocks/set_route_prefs?route="+j.route+"&ext="+j.ext,e.serialize())},L=function(e){var n=t(".block-position");t.getJSON(j.ajaxUrl+"/blocks/copy_route?route="+j.route+"&ext="+j.ext+"&"+t.param(e),function(e){0!==e.list.length&&(z(),n.empty(),t.each(e.list,function(e,n){var i=t("#pos-"+e);t.each(n,function(t,e){e.content=$(e.content);var n=d.render(e);i.append('<div id="block-'+e.id+'" class="unit size1of1 block"></div>'),i.find("#block-"+e.id).html(n)}),i.hasClass("horizontal")&&N(i.find(".block"))}),T())})},Q=function(){var e={};t(".block-position").each(function(){var n=0,o=t(this).attr("id");t(this).find(".block").each(function(a,l){var s=t(l).attr("id");if(o!==i&&s!==i){var r=s.substring(6);e[r]={position:o.substring(4),weight:n},n++}})}),t.post(j.ajaxUrl+"/blocks/save_blocks",{route:j.route,blocks:e},function(){_.button("disable"),l=!1})},V=function(t){return a===!0?void f.children(":input").trigger("blur"):(a=!0,o=t.removeClass("editable").text(),void f.show().appendTo(t.text("")).children(":input").val(o).focus().select().end())},W=function(e){var n=f.parent();a=!1,o="",n.addClass("editable").text(e),f.hide().appendTo(t("body"))},G=function(e){if(a!==!1){var n=t(e).parentsUntil(".block").parent().attr("id").substring(6),i=t(e).val();return n&&i!==o?F({id:n,field:"title",title:i}):W(o),!1}},H=function(){var e=t.extend(!0,{},C),n=g.find("#edit_form").serializeArray();t.each(n,function(){e[this.name]=this.value}),A(x,e)},K=function(){A(x,C)},X=function(){O.init({selector:"div.editable-block",inline:!0,image_advtab:!0,plugins:["advlist autolink lists link image imagetools charmap anchor","visualblocks code hr","media table contextmenu paste"],valid_elements:"*[*]",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | hr link image | code",setup:function(e){var n="",i="";e.on("blur",function(){var o=e.getContent({format:"raw"});if(e.getContent().length>0){var a=t("#"+e.id).data("raw",o).data();o!==i&&o!==w.placeholder?(a.id=e.id.substring(13),a.content=o,P(a)):e.setContent(n)}else n?e.setContent(n):e.setContent(w.placeholder)}),e.on("init",function(){0===e.getContent().length&&e.setContent(w.placeholder)}),e.on("focus",function(){i=t("#"+e.id).data("raw"),n=e.getContent({format:"raw"}),e.setContent(i)})}})},Y=function(t){t&&(y.html(t),y.fadeIn().delay(3e3).fadeOut())},Z=function(t,e){t?Y('<span><i class="fa fa-info-circle fa-blue fa-lg"></i> '+w.hidingBlocks+"</span>"):e.length&&Y('<span><i class="fa fa-info-circle fa-blue fa-lg"></i> '+w.hidingPos+": <strong>"+e.join(", ")+"</strong></span>")},$=function(t){return t.replace(new RegExp("./../../","g"),"./../")};t(n).ready(function(){S=e.editMode||!1,w=e.lang||{},U=e.phpbb||{},O=e.tinymce||{},D=e.twig||{},j=e.config||{ajaxUrl:"",boardUrl:"",route:"",ext:"",style:""};var n="",o={},a={},C={},A=!1,P=t("#admin-bar").delay(300).slideDown().find("#admin-control").click(function(){if(S)return t(this).prev().toggle(),!1}).find("i");if(S){f=t('<form class="inline-form"><input type="text" class="inline-edit" value="" /></form>').hide().appendTo(t("body")),y=t("#ajax-message"),c=t('.block-position:not(:has(".block"))').addClass("empty-position"),d=D({data:t.trim(t("#block-template-container").html())}),t("#add-block-panel").find(".sitemaker-block").draggable({addClasses:!1,iframeFix:!0,opacity:.7,helper:"clone",appendTo:"body",revert:"invalid",connectToSortable:".block-position",start:function(e,n){t(n.helper).addClass("dragging"),z(),r.sortable("refresh"),o.trigger("click")},stop:function(){e.setTimeout(function(){l===!1&&T()},600)}}),a=t("#ex_positions"),r=t(".block-position").addClass("block-receiver").sortable({revert:!0,placeholder:"ui-state-highlight grid__col sm-block-spacing block sortable placeholder",connectWith:".block-position",cancel:".editable-block, .inline-edit",items:".block",tolerance:"pointer",cursor:"move",cursorAt:{top:-10,left:-10},start:function(e,n){u=t(n.item).addClass("dragging").parent(".horizontal"),z(),r.sortable("refresh")},over:function(t,e){C=e.placeholder.parent(".horizontal").children(".block").addClass("sortable")},out:function(){t.isEmptyObject(C)===!1&&C.removeClass("sortable")},update:function(e,n){if(l=!0,t(n.item).attr("id")===i){var o=t(this).attr("id").substring(4),a=t(n.item).attr("data-block"),s=t(this).find('div[data-block="'+a+'"]');E(o,a,s)}else _.button("enable");var r=t(n.item).removeAttr("style").parent(".horizontal").children(".block"),c=t(n.item);c.parent().removeClass("empty-position"),J(c),r.length>0&&N(r),u.attr("id")!==t(n.item).parent(".horizontal").attr("id")&&N(u.find(".block").removeClass("sortable"))},stop:function(e,n){t(n.item).removeClass("dragging sortable").removeAttr("style"),T(),t("body").trigger("layoutChanged")}}).on("click",".block-title",function(){V(t(this))}).on("submit",".inline-form",function(e){e.preventDefault(),t(this).find(".inline-edit").trigger("blur")}).on("focusout",".inline-edit",function(){G(t(this))}).on("click",".edit-block",function(e){e.preventDefault(),x=t(this).parentsUntil(".block").parent(),M(x)}).on("click",".delete-block",function(e){e.preventDefault(),x=t(this).parentsUntil(".block").parent(),p.dialog({buttons:m}).dialog("open")}).each(function(e,n){var i=t(n).attr("id").substring(4);0===a.find("option[value="+i+"]").length&&a.append('<option value="'+i+'">'+i+"</option>")}),U.addAjaxCallback("previewCustomBlock",function(e){t("#block-editor-"+e.id).html(e.content.replace("./../../",""))}),_=t("#toggle-edit").button().click(function(){}).parent().next().children("a").button({disabled:!0}).click(function(t){t.preventDefault(),Q()}),t(".has-dropdown").click(function(e){e.preventDefault(),t(this).parentsUntil("ul").parent().find(".dropped").not(t(this)).removeClass("dropped").next().hide(),o=t(this).toggleClass("dropped"),o.next().toggle()}).next().mouseleave(function(){}),t("#admin-options").show(100,function(){var e=t.grep(a.val(),function(t){return t.length});Z(A,e)}),t.ajaxSetup({beforeSend:function(t,e){P.addClass("fa-spinner fa-green fa-spin fa-lg fa-pulse"),e.url+=(e.url.indexOf("?")<0?"?":"&")+"style="+j.style},complete:function(t){P.delay(1e3).removeClass("fa-spinner fa-green fa-spin fa-lg fa-pulse"),t.responseJSON&&(t.responseJSON.message&&Y(t.responseJSON.message),t.responseJSON.content&&(t.responseJSON.content=$(t.responseJSON.content)))},error:function(t){Y(t.responseJSON.message?t.responseJSON.message:w.ajaxError)}}),v[w.edit]=function(){B(x)},v[w.cancel]=function(){K(),t(this).dialog("close")},m[w.remove]=function(){var e=x.parent(".horizontal");x.remove(),e.find(".ui-effects-placeholder").remove();var n=e.find(".block");n.length>0&&N(n),T(),_.button("enable"),t(this).dialog("close")},m[w.cancel]=function(){t(this).dialog("close")};var W={autoOpen:!1,modal:!0,width:"auto",show:"slide",hide:"slide"};p=t("#dialog-confirm").dialog(W),k[w.deleteAll]=function(){t(this).dialog("close"),t(".block-position").empty(),T(),_.button("enable"),l=!0},k[w.cancel]=function(){t(this).dialog("close")};var tt=t("#dialog-delete-all").dialog(W),et=t("#delete-blocks").button().click(function(t){t.preventDefault(),tt.dialog({buttons:k}).dialog("open")});h[w.copy]=function(){t(this).dialog("close"),L(n),et.parent().show()},h[w.cancel]=function(){t(this).dialog("close")},b=t("#dialog-copy").dialog(W),t("#copy-form").find(".layout-action").button().click(function(e){e.preventDefault(),n=t(this).parent().parent().serializeArray();var i=n[0].value,a=n[1].value,l=t(this).data("action");if(""===i||i===j.route&&a===j.style)return!1;if("copy"===l)o.trigger("click"),b.dialog({buttons:h}).dialog("open");else{var s="";s+=("/"===i.substring(0,1)?j.ajaxUrl:j.boardUrl+"/")+i,s+=(s.indexOf("?")>=0?"&":"?")+"style="+a+"&edit_mode=1",location.href=s}}),W.open=function(){if(s===!1){var e=t(this).dialog("widget").find(".ui-dialog-buttonpane");s=!0,t('<label class="dialog-check-button"><input id="update-similar" type="checkbox" checked="checked" />'+w.updateSimilar+"</label>").prependTo(e)}},g=t("#dialog-edit").dialog(W).on("click",".block-class-actions",function(e){switch(e.preventDefault(),t(this).data("action")){case"clear":g.find("#block_class").val("").change();break;case"toggle":g.find("#css-class-options").slideToggle()}}).on("click",".class-cat",function(e){var n=t(this).attr("href"),i=t("#classes-scroller");i.animate({scrollTop:i.scrollTop()+t(n).position().top-200},1e3),e.preventDefault()}).on("click",".transform",function(e){var n=g.find("#block_class"),i=n.val();i=(i?i+" ":"")+t(this).text(),n.val(i).change(),e.preventDefault()}).on("change",".block-preview",function(){H()}),t(".default-layout").button().click(function(e){var n=t(this).data("set");R(n),e.preventDefault(),n===!0?(t(this).parent().hide().next().hide().next().show(),et.parent().hide()):(t(this).parent().hide().prev().hide().prev().show(),et.parent().show())}),t(".sm-startpage").button().click(function(e){e.preventDefault();var n={};"set-startpage"===t(this).attr("id")?(t(this).parent().hide().next().show(),n={controller:t(this).data("controller"),method:t(this).data("method"),params:t(this).data("params")},q(n)):(t(this).parent().hide().prev().show(),q(n))}),A=t("#route-settings").submit(function(e){I(t(this)),e.preventDefault()}).find("#hide_blocks").is(":checked"),e.onbeforeunload=function(t){if(l===!0)return t=t||e.event,t&&(t.returnValue=w.leaveConfirm),w.leaveConfirm},t(".sitemaker").iconPicker({selector:".block-icon",onSelect:function(t,e,n){var i=t.parentsUntil(".block").parent().attr("id").substring(6);F({id:i,icon:n})}}),X()}})}(jQuery,window,document);
//# sourceMappingURL=manager.min.js.map
