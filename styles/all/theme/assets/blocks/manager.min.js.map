{"version":3,"sources":["blocks/manager.min.js"],"names":["$","window","document","undefined","editorVal","editing","updated","dialogEditOpened","blockPositions","emptyPositionsObj","template","origin","inlineForm","dialogConfirm","dialogEdit","dialogCopy","cButtons","dButtons","eButtons","lButtons","blockObj","blockData","editable","block","msgObj","saveBtn","lang","config","editMode","phpbb","tinymce","twig","sortHorizontal","items","numItems","length","numCols","parent","data","itemsLeft","divisibleItems","hasClass","i","removeGrid","slice","addClass","n","removeClass","matches","this","className","match","join","showAllPositions","siblings","hideEmptyPositions","each","pos","last","renderBlock","id","get","EditorManager","execCommand","html","render","find","addBlock","posID","blockName","droppedElement","removeAttr","ajaxLoading","trim","weight","index","route","ext","position","getJSON","ajaxUrl","result","remove","attr","children","not","show","percent","saveLayout","getEditForm","substring","resp","form","tabs","$this","change","toggleSelectSettings","dialog","buttons","edit","title","saveForm","updateSimilar","serialize","list","row","content","fixPaths","updateBlock","post","undoEditable","customBlockAction","ajaxCallbacks","callback","call","setDefaultLayout","set","setStartPage","info","param","setRoutePrefs","copyBlocks","copyFrom","empty","blocks","append","e","bid","button","makeEditable","element","trigger","text","appendTo","val","focus","select","end","v","hide","processInput","parentsUntil","field","previewBlock","extend","formData","serializeArray","name","value","undoPreviewBlock","initTinyMce","init","selector","inline","image_advtab","plugins","valid_elements","toolbar","setup","editor","editorPreview","editorContent","on","getContent","format","placeholder","setContent","showMessage","message","fadeIn","delay","fadeOut","showCurrentState","hidingBlocks","positions","hidingPos","subject","replace","RegExp","ready","boardUrl","style","blocksPanel","exPositions","overPosition","isHidingBlocks","loader","slideDown","click","prev","toggle","draggable","addClasses","iframeFix","opacity","helper","revert","connectToSortable","start","event","ui","sortable","stop","setTimeout","connectWith","cancel","tolerance","cursor","cursorAt","top","left","item","over","out","isEmptyObject","update","preventDefault","p","addAjaxCallback","next","disabled","toggleClass","mouseleave","exPos","grep","str","ajaxSetup","beforeSend","xhr","settings","url","indexOf","complete","responseJSON","error","ajaxError","horizontalPos","defDialog","autoOpen","modal","width","deleteAll","dialogDeleteAll","copy","fromRoute","fromStyle","layoutAction","location","href","open","pane","prependTo","slideToggle","obj","animate","scrollTop","classObj","classes","setDefault","controller","method","params","submit","is","onbeforeunload","returnValue","leaveConfirm","iconPicker","onSelect","iconHtml","iconClass","icon","jQuery"],"mappings":"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","file":"blocks/manager.min.js","sourcesContent":[";(function($, window, document, undefined) {\n\t'use strict';\n\n\tvar editorVal = '';\n\tvar editing = false;\n\tvar updated = false;\n\tvar dialogEditOpened = false;\n\tvar blockPositions = {};\n\tvar emptyPositionsObj = {};\n\tvar template = {};\n\tvar origin = {};\n\tvar inlineForm = {};\n\tvar dialogConfirm = {};\n\tvar dialogEdit = {};\n\tvar dialogCopy = {};\n\tvar cButtons = {};\n\tvar dButtons = {};\n\tvar eButtons = {};\n\tvar lButtons = {};\n\tvar blockObj = {};\n\tvar blockData = {\n\t\teditable: ' editable',\n\t\tblock: {}\n\t};\n\tvar msgObj = {};\n\tvar saveBtn = {};\n\n\t// These variables are defined in template file\n\tvar lang = {};\n\tvar config = {};\n\tvar editMode = false;\n\n\t// These objects are provided by third-party scripts\n\tvar phpbb = {};\n\tvar tinymce = {};\n\tvar twig = {};\n\n\tvar sortHorizontal = function(items) {\n\t\tvar numItems = items.length;\n\t\tvar numCols = (items.parent().data('columns') !== undefined) ? ((items.parent().data('columns') <= 5) ? items.parent().data('columns') : 5) : 3;\n\t\tvar itemsLeft = numItems % numCols;\n\t\tvar divisibleItems = numItems - itemsLeft;\n\n\t\tif (numItems <= numCols) {\n\t\t\tnumCols = numItems;\n\t\t} else if (items.parent().hasClass('equal')) {\n\t\t\tif (itemsLeft > 0 && numCols > 3) {\n\t\t\t\tfor (var i = 1; i < itemsLeft; i++) {\n\t\t\t\t\tif (numItems % (numCols - i) === 0) {\n\t\t\t\t\t\tnumCols = numCols - i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tdivisibleItems = numItems;\n\t\t\titemsLeft = 0;\n\t\t}\n\n\t\tremoveGrid(items);\n\n\t\tif (divisibleItems > 0) {\n\t\t\titems.slice(0, divisibleItems).addClass('grid__col grid__col--1-of-' + numCols);\n\t\t}\n\n\t\tif (itemsLeft) {\n\t\t\tvar n = 1;\n\t\t\tif (itemsLeft < 2) {\n\t\t\t\tn = 5;\n\t\t\t\titemsLeft = 5;\n\t\t\t}\n\t\t\titems.slice(divisibleItems, numItems)\n\t\t\t\t.addClass('grid__col grid__col--' + n + '-of-' + itemsLeft);\n\t\t}\n\t};\n\n\tvar removeGrid = function(items) {\n\t\titems.removeClass(function() {\n\t\t\tvar matches = this.className.match(/grid__col+(\\S+)?/gi);\n\t\t\treturn (matches) ? matches.join(' ') : '';\n\t\t});\n\t};\n\n\tvar showAllPositions = function() {\n\t\tblockPositions.addClass('show-position');\n\t\temptyPositionsObj.removeClass('empty-position').siblings('.grid__col').removeClass('lastUnit');\n\t};\n\n\tvar hideEmptyPositions = function() {\n\t\tblockPositions.removeClass('show-position');\n\t\temptyPositionsObj = $('.block-position:not(:has(\".block\"))').addClass('empty-position').each(function(i, pos) {\n\t\t\t$(pos).siblings('.grid__col').last().addClass('lastUnit');\n\t\t});\n\t};\n\n\tvar renderBlock = function(blockObj, blockData) {\n\t\tvar id = 'block-editor-' + blockData.id;\n\n\t\t// if tinymce editor instance already exists, remove it\n\t\tif (tinymce.get(id)) {\n\t\t\ttinymce.EditorManager.execCommand('mceFocus', false, id);                    \n\t\t\ttinymce.EditorManager.execCommand('mceRemoveEditor', true, id);\n\t\t}\n\n\t\t// update the html\n\t\tblockObj.html(template.render(blockData));\n\n\t\t// if custom block, add editor\n\t\tif (blockObj.find('#' + id).length) {\n\t\t\ttinymce.EditorManager.execCommand('mceAddEditor', false, id);\n\t\t}\n\t};\n\n\tvar addBlock = function(posID, blockName, droppedElement) {\n\t\t$(droppedElement).removeAttr('role aria-disabled data-block class style')\n\t\t\t.addClass('block')\n\t\t\t.html('<div class=\"ui-state-highlight sm-block-spacing sortable\" style=\"padding: 5px\"><i class=\"fa fa-spinner fa-2x fa-spin\"></i> ' + lang.ajaxLoading + '</div>');\n\n\t\tvar data = {\n\t\t\tblock: $.trim(blockName),\n\t\t\tweight: droppedElement.parent().find('.block').index(droppedElement),\n\t\t\troute: config.route,\n\t\t\text: config.ext,\n\t\t\tposition: posID\n\t\t};\n\n\t\t$.getJSON(config.ajaxUrl + '/blocks/add_block', data, function(result) {\n\t\t\tupdated = false;\n\t\t\tif (result.id === '') {\n\t\t\t\t$(droppedElement).remove();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar blockObj = $(droppedElement).attr('id', 'block-' + result.id);\n\n\t\t\trenderBlock(blockObj, result);\n\t\t\tblockObj.children().not('.block-controls')\n\t\t\t\t.show('scale', {percent: 100}, 1000);\n\n\t\t\tif (updated) {\n\t\t\t\tsaveLayout();\n\t\t\t}\n\t\t});\n\t};\n\n\tvar getEditForm = function(block) {\n\t\t$.getJSON(config.ajaxUrl + '/blocks/edit_block', {id: block.attr('id').substring(6)}, function(resp) {\n\t\t\tblockData.block = resp;\n\t\t\tif (resp.form) {\n\t\t\t\tdialogEdit.html(resp.form);\n\t\t\t\tdialogEdit.find('#block-settings').tabs();\n\t\t\t\tdialogEdit.find('select[data-togglable-settings]').each(function() {\n\t\t\t\t\tvar $this = $(this);\n\n\t\t\t\t\t$this.change(function() {\n\t\t\t\t\t\tphpbb.toggleSelectSettings($this);\n\t\t\t\t\t});\n\t\t\t\t\tphpbb.toggleSelectSettings($this);\n\t\t\t\t});\n\t\t\t\tdialogEdit.dialog({buttons: eButtons}).dialog('option', 'title', lang.edit + ' - ' + resp.title).dialog('open');\n\t\t\t}\n\t\t});\n\t};\n\n\tvar saveForm = function(block) {\n\t\tvar form = $('#edit_form');\n\t\tvar updateSimilar = dialogEdit.dialog('widget').find('#update-similar:checked').length;\n\n\t\t$.getJSON(config.ajaxUrl + '/blocks/save_block?route=' + config.route + '&id=' + block.attr('id').substring(6) + '&similar=' + updateSimilar + '&' + form.serialize(), function(resp) {\n\t\t\tdialogEdit.dialog('close');\n\n\t\t\tif (resp.list) {\n\t\t\t\t$.each(resp.list, function(i, row) {\n\t\t\t\t\trow.content = fixPaths(row.content);\n\t\t\t\t\trenderBlock($('#block-' + row.id), row);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\tvar updateBlock = function(data) {\n\t\tif (data.id === undefined) {\n\t\t\treturn false;\n\t\t}\n\t\t$.post(config.ajaxUrl + '/blocks/update_block' + '?route=' + config.route, data,\n\t\t\tfunction(resp) {\n\t\t\t\tif (editing === true) {\n\t\t\t\t\tundoEditable(resp.title);\n\t\t\t\t}\n\t\t\t},\n\t\t\t'json'\n\t\t);\n\t};\n\n\tvar customBlockAction = function(data) {\n\t\tif (data.id === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\t$.getJSON(config.ajaxUrl + '/blocks/handle_custom_action', data, function(resp) {\n\t\t\tif (typeof phpbb.ajaxCallbacks[resp.callback] === 'function') {\n\t\t\t\tphpbb.ajaxCallbacks[resp.callback].call(undefined, resp);\n\t\t\t}\n\t\t});\n\t};\n\n\tvar setDefaultLayout = function(set) {\n\t\t$.post(config.ajaxUrl + '/blocks/set_default_route' + '?route=' + ((set === true) ? config.route : ''));\n\t};\n\n\tvar setStartPage = function(info) {\n\t\t$.post(config.ajaxUrl + '/blocks/set_startpage', $.param(info));\n\t};\n\n\tvar setRoutePrefs = function(form) {\n\t\t$.post(config.ajaxUrl + '/blocks/set_route_prefs' + '?route=' + config.route + '&ext=' + config.ext, form.serialize());\n\t};\n\n\tvar copyBlocks = function(copyFrom) {\n\t\tvar position = $('.block-position');\n\t\t$.getJSON(config.ajaxUrl + '/blocks/copy_route?route=' + config.route + '&ext=' + config.ext + '&' + $.param(copyFrom), function(resp) {\n\t\t\tif (resp.list.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tshowAllPositions();\n\t\t\tposition.empty();\n\n\t\t\t$.each(resp.list, function(position, blocks) {\n\t\t\t\tvar pos = $('#pos-' + position);\n\t\t\t\t$.each(blocks, function(i, row) {\n\t\t\t\t\trow.content = fixPaths(row.content);\n\t\t\t\t\tblockData.block = row;\n\n\t\t\t\t\tpos.append('<div id=\"block-' + row.id + '\" class=\"unit size1of1 block\"></div>');\n\t\t\t\t\tpos.find('#block-' + row.id).html(template.render(blockData));\n\t\t\t\t});\n\n\t\t\t\tif (pos.hasClass('horizontal')) {\n\t\t\t\t\tsortHorizontal(pos.find('.block'));\n\t\t\t\t}\n\t\t\t});\n\t\t\thideEmptyPositions();\n\t\t});\n\t};\n\n\tvar saveLayout = function() {\n\t\tvar blocks = {};\n\t\t$('.block-position').each(function() {\n\t\t\tvar weight = 0;\n\t\t\tvar pos = $(this).attr('id');\n\t\t\t$(this).find('.block').each(function(i, e) {\n\t\t\t\tvar id = $(e).attr('id');\n\t\t\t\tif (pos !== undefined && id !== undefined) {\n\t\t\t\t\tvar bid = id.substring(6);\n\t\t\t\t\tblocks[bid] = {\n\t\t\t\t\t\t'position': pos.substring(4),\n\t\t\t\t\t\t'weight': weight\n\t\t\t\t\t};\n\t\t\t\t\tweight++;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$.post(config.ajaxUrl + '/blocks/save_blocks', {route: config.route, blocks: blocks}, function() {\n\t\t\tsaveBtn.button('disable');\n\t\t\tupdated = false;\n\t\t});\n\t};\n\n\tvar makeEditable = function(element) {\n\t\tif (editing === true) {\n\t\t\tinlineForm.children(':input').trigger('blur');\n\t\t\treturn;\n\t\t}\n\t\tediting = true;\n\t\teditorVal = element.removeClass('editable').text();\n\t\tinlineForm.show().appendTo(element.text('')).children(':input').val(editorVal).focus().select().end();\n\t};\n\n\tvar undoEditable = function(v) {\n\t\tvar element = inlineForm.parent();\n\n\t\tediting = false;\n\t\teditorVal = '';\n\t\telement.addClass('editable').text(v);\n\t\tinlineForm.hide().appendTo($('body'));\n\t};\n\n\tvar processInput = function(e) {\n\t\tif (editing === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar id = $(e).parentsUntil('.block').parent().attr('id').substring(6);\n\t\tvar title = $(e).val();\n\n\t\tif (id && title !== editorVal) {\n\t\t\tupdateBlock({'id': id, 'field': 'title', 'title': title});\n\t\t} else {\n\t\t\tundoEditable(editorVal);\n\t\t}\n\t\treturn false;\n\t};\n\n\tvar previewBlock = function() {\n\t\t// make a copy of block data\n\t\tvar data = $.extend(true, {}, blockData);\n\t\tvar formData = dialogEdit.find('#edit_form').serializeArray();\n\n\t\t$.each(formData, function() {\n\t\t\tdata.block[this.name] = (typeof data.block[this.name] === 'boolean') ? ((this.value === '1') ? true : false) : this.value;\n\t\t});\n\n\t\tdata.block['class'] = ' ' + data.block['class'].trim();\n\n\t\trenderBlock(blockObj, data);\n\t};\n\n\tvar undoPreviewBlock = function() {\n\t\trenderBlock(blockObj, blockData);\n\t};\n\n\tvar initTinyMce = function() {\n\t\ttinymce.init({\n\t\t\t'selector': 'div.editable-block',\n\t\t\t'inline': true,\n\t\t\t'image_advtab': true,\n\t\t\t'plugins': [\n\t\t\t\t'advlist autolink lists link image charmap anchor pagebreak',\n\t\t\t\t'visualblocks visualchars code',\n\t\t\t\t'media nonbreaking save table contextmenu',\n\t\t\t\t'paste textcolor colorpicker textpattern imagetools'\n\t\t\t],\n\t\t\t'valid_elements': '*[*]',\n\t\t\t'toolbar': 'undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | hr link image media | forecolor backcolor | code',\n\t\t\t'setup': function(editor) {\n\t\t\t\tvar editorPreview = '';\n\t\t\t\tvar editorContent = '';\n\t\t\t\teditor.on('blur', function() {\n\t\t\t\t\tvar content = editor.getContent({format: 'raw'});\n\n\t\t\t\t\tif (editor.getContent().length > 0) {\n\t\t\t\t\t\tvar data = $('#' + editor.id).data('raw', content).data();\n\n\t\t\t\t\t\tif (content !== editorContent && content !== lang.placeholder) {\n\t\t\t\t\t\t\tdata.id = editor.id.substring(13);\n\t\t\t\t\t\t\tdata.content = content;\n\n\t\t\t\t\t\t\tcustomBlockAction(data);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\teditor.setContent(editorPreview);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (editorPreview) {\n\t\t\t\t\t\teditor.setContent(editorPreview);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.setContent(lang.placeholder);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\teditor.on('init', function() {\n\t\t\t\t\tif (editor.getContent().length === 0) {\n\t\t\t\t\t\teditor.setContent(lang.placeholder);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\teditor.on('focus', function() {\n\t\t\t\t\teditorContent = $('#' + editor.id).data('raw');\n\t\t\t\t\teditorPreview = editor.getContent({format: 'raw'});\n\t\t\t\t\teditor.setContent(editorContent);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\tvar showMessage = function(message) {\n\t\tif (message) {\n\t\t\tmsgObj.html(message);\n\t\t\tmsgObj.fadeIn().delay(3000).fadeOut();\n\t\t}\n\t};\n\n\tvar showCurrentState = function(hidingBlocks, positions) {\n\t\tif (hidingBlocks) {\n\t\t\tshowMessage('<span><i class=\"fa fa-info-circle fa-blue fa-lg\"></i> ' + lang.hidingBlocks + '</span>');\n\t\t} else if (positions.length) {\n\t\t\tshowMessage('<span><i class=\"fa fa-info-circle fa-blue fa-lg\"></i> ' + lang.hidingPos + ': <strong>' + positions.join(', ') + '</strong></span>');\n\t\t}\n\t};\n\n\tvar fixPaths = function(subject) {\n\t\treturn subject.replace(new RegExp('./../../', 'g'), config.route ? './../' : './');\n\t};\n\n\t$(document).ready(function() {\n\t\teditMode = window.editMode || false;\n\t\tlang = window.lang || {};\n\t\tphpbb = window.phpbb || {};\n\t\ttinymce = window.tinymce || {};\n\t\ttwig = window.twig || {};\n\t\tconfig = window.config || {\n\t\t\tajaxUrl: '',\n\t\t\tboardUrl: '',\n\t\t\troute: '',\n\t\t\text: '',\n\t\t\tstyle: ''\n\t\t};\n\n\t\tvar copyFrom = '';\n\t\tvar blocksPanel = {};\n\t\tvar exPositions = {};\n\t\tvar overPosition = {};\n\t\tvar isHidingBlocks = false;\n\n\t\tvar loader = $('#admin-bar').delay(300).slideDown().find('#admin-control').click(function() {\n\t\t\tif (editMode) {\n\t\t\t\t$(this).prev().toggle();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}).find('i');\n\n\t\tif (editMode) {\n\t\t\tinlineForm = $('<form class=\"inline-form\"><input type=\"text\" class=\"inline-edit\" value=\"\" /></form>').hide().appendTo($('body'));\n\n\t\t\tmsgObj = $('#ajax-message');\n\t\t\temptyPositionsObj = $('.block-position:not(:has(\".block\"))').addClass('empty-position');\n\n\t\t\ttemplate = twig({\n\t\t\t\tdata: $.trim($('#block-template-container').html())\n\t\t\t});\n\n\t\t\t$('#add-block-panel').find('.sitemaker-block').draggable({\n\t\t\t\taddClasses: false,\n\t\t\t\tiframeFix: true,\n\t\t\t\topacity: 0.7,\n\t\t\t\thelper: 'clone',\n\t\t\t\tappendTo: 'body',\n\t\t\t\trevert: 'invalid',\n\t\t\t\tconnectToSortable: '.block-position',\n\t\t\t\tstart: function(event, ui) {\n\t\t\t\t\t$(ui.helper).addClass('dragging');\n\t\t\t\t\tshowAllPositions();\n\t\t\t\t\tblockPositions.sortable('refresh');\n\t\t\t\t\tblocksPanel.trigger('click');\n\t\t\t\t},\n\t\t\t\tstop: function() {\n\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\tif (updated === false) {\n\t\t\t\t\t\t\thideEmptyPositions();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 600);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\texPositions = $('#ex_positions');\n\t\t\tblockPositions = $('.block-position').addClass('block-receiver').sortable({\n\t\t\t\trevert: true,\n\t\t\t\tplaceholder: 'ui-state-highlight grid__col sm-block-spacing block sortable placeholder',\n\t\t\t\tconnectWith: '.block-position',\n\t\t\t\tcancel: '.editable-block, .inline-edit',\n\t\t\t\titems: '.block',\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\tcursor: 'move',\n\t\t\t\tcursorAt: {\n\t\t\t\t\ttop: -10,\n\t\t\t\t\tleft: -10\n\t\t\t\t},\n\t\t\t\tstart: function(event, ui) {\n\t\t\t\t\torigin = $(ui.item).addClass('dragging').parent('.horizontal');\n\t\t\t\t\tshowAllPositions();\n\t\t\t\t\tblockPositions.sortable('refresh');\n\t\t\t\t},\n\t\t\t\tover: function(event, ui) {\n\t\t\t\t\toverPosition = ui.placeholder.parent('.horizontal').children('.block').addClass('sortable');\n\t\t\t\t},\n\t\t\t\tout: function() {\n\t\t\t\t\tif ($.isEmptyObject(overPosition) === false) {\n\t\t\t\t\t\toverPosition.removeClass('sortable');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tupdate: function(event, ui) {\n\t\t\t\t\tupdated = true;\n\t\t\t\t\tif ($(ui.item).attr('id') === undefined) {\n\t\t\t\t\t\tvar posID = $(this).attr('id').substring(4);\n\t\t\t\t\t\tvar blockName = $(ui.item).attr('data-block');\n\t\t\t\t\t\tvar replace = $(this).find('div[data-block=\"' + blockName + '\"]');\n\t\t\t\t\t\taddBlock(posID, blockName, replace);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsaveBtn.button('enable');\n\t\t\t\t\t}\n\n\t\t\t\t\tvar items = $(ui.item).removeAttr('style').parent('.horizontal').children('.block');\n\t\t\t\t\tvar item = $(ui.item);\n\n\t\t\t\t\titem.parent().removeClass('empty-position');\n\t\t\t\t\tremoveGrid(item);\n\n\t\t\t\t\tif (items.length > 0) {\n\t\t\t\t\t\tsortHorizontal(items);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (origin.attr('id') !== $(ui.item).parent('.horizontal').attr('id')) {\n\t\t\t\t\t\tsortHorizontal(origin.find('.block').removeClass('sortable'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstop: function(event, ui) {\n\t\t\t\t\t$(ui.item).removeClass('dragging sortable').removeAttr('style');\n\t\t\t\t\thideEmptyPositions();\n\t\t\t\t\t$('body').trigger('layoutChanged');\n\t\t\t\t}\n\t\t\t}).on('click', '.block-title', function() {\n\t\t\t\tmakeEditable($(this));\n\t\t\t}).on('submit', '.inline-form', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\t$(this).find('.inline-edit').trigger('blur');\n\t\t\t}).on('focusout', '.inline-edit', function() {\n\t\t\t\tprocessInput($(this));\n\t\t\t}).on('click', '.edit-block', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tblockObj = $(this).parentsUntil('.block').parent();\n\t\t\t\tgetEditForm(blockObj);\n\t\t\t}).on('click', '.delete-block', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tblockObj = $(this).parentsUntil('.block').parent();\n\t\t\t\tdialogConfirm.dialog({buttons: dButtons}).dialog('open');\n\t\t\t}).each(function(i, pos) {\n\t\t\t\tvar p = $(pos).attr('id').substring(4);\n\t\t\t\tif (exPositions.find('option[value=' + p + ']').length === 0) {\n\t\t\t\t\texPositions.append('<option value=\"' + p + '\">' + p + '</option>');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tphpbb.addAjaxCallback('previewCustomBlock', function(data) {\n\t\t\t\t$('#block-editor-' + data.id).html(data.content.replace('./../../', ''));\n\t\t\t});\n\n\t\t\tsaveBtn = $('#toggle-edit').button().click(function() {\n\t\t\t\t// exit edit mode\n\t\t\t}).parent().next().children('a').button({disabled: true}).click(function(e) {\n\t\t\t\t// save changes\n\t\t\t\te.preventDefault();\n\t\t\t\tsaveLayout();\n\t\t\t});\n\n\t\t\t$('.has-dropdown').click(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\t$(this).parentsUntil('ul').parent().find('.dropped').not($(this)).removeClass('dropped').next().hide();\n\t\t\t\tblocksPanel = $(this).toggleClass('dropped');\n\t\t\t\tblocksPanel.next().toggle();\n\t\t\t}).next().mouseleave(function() {\n\t\t\t\t//$(this).prev().trigger('click');\n\t\t\t});\n\n\t\t\t$('#admin-options').show(100, function() {\n\t\t\t\tvar exPos = $.grep(exPositions.val(), function(str) {\n\t\t\t\t\treturn str.length;\n\t\t\t\t});\n\t\t\t\tshowCurrentState(isHidingBlocks, exPos);\n\t\t\t});\n\n\t\t\t$.ajaxSetup({\n\t\t\t\t// add style id to ajax requests\n\t\t\t\t'beforeSend': function(xhr, settings) {\n\t\t\t\t\tloader.addClass('fa-spinner fa-green fa-spin fa-lg fa-pulse');\n\t\t\t\t\tsettings.url += ((settings.url.indexOf('?') < 0) ? '?' : '&') + 'style=' + config.style;\n\t\t\t\t},\n\t\t\t\t'complete': function(data) {\n\t\t\t\t\tloader.delay(1000).removeClass('fa-spinner fa-green fa-spin fa-lg fa-pulse');\n\n\t\t\t\t\tif (data.responseJSON) {\n\t\t\t\t\t\t// Display any returned message\n\t\t\t\t\t\tif (data.responseJSON.message) {\n\t\t\t\t\t\t\tshowMessage(data.responseJSON.message);\n\t\t\t\t\t\t}\n\t\n\t\t\t\t\t\t// Fix relative paths\n\t\t\t\t\t\tif (data.responseJSON.content) {\n\t\t\t\t\t\t\tdata.responseJSON.content = fixPaths(data.responseJSON.content);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'error': function(event) {\n\t\t\t\t\tshowMessage((event.responseJSON.message) ? event.responseJSON.message : lang.ajaxError);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teButtons[lang.edit] = function() {\n\t\t\t\tsaveForm(blockObj);\n\t\t\t};\n\n\t\t\teButtons[lang.cancel] = function() {\n\t\t\t\tundoPreviewBlock();\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tdButtons[lang.remove] = function() {\n\t\t\t\tvar horizontalPos = blockObj.parent('.horizontal');\n\n\t\t\t\tblockObj.remove();\n\t\t\t\thorizontalPos.find('.ui-effects-placeholder').remove();\n\n\t\t\t\tvar items = horizontalPos.find('.block');\n\n\t\t\t\tif (items.length > 0) {\n\t\t\t\t\tsortHorizontal(items);\n\t\t\t\t}\n\n\t\t\t\thideEmptyPositions();\n\t\t\t\tsaveBtn.button('enable');\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tdButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tvar defDialog = {\n\t\t\t\tautoOpen: false,\n\t\t\t\tmodal: true,\n\t\t\t\twidth: 'auto',\n\t\t\t\tshow: 'slide',\n\t\t\t\thide: 'slide'\n\t\t\t};\n\n\t\t\tdialogConfirm = $('#dialog-confirm').dialog(defDialog);\n\n\t\t\t// Delete all blocks\n\t\t\tlButtons[lang.deleteAll] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t\t$('.block-position').empty();\n\t\t\t\thideEmptyPositions();\n\t\t\t\tsaveBtn.button('enable');\n\t\t\t\tupdated = true;\n\t\t\t};\n\n\t\t\tlButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tvar dialogDeleteAll = $('#dialog-delete-all').dialog(defDialog);\n\t\t\tvar deleteAll = $('#delete-blocks').button().click(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tdialogDeleteAll.dialog({buttons: lButtons}).dialog('open');\n\t\t\t});\n\n\t\t\t// Initiate dialog for block copy\n\t\t\tcButtons[lang.copy] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t\tcopyBlocks(copyFrom);\n\t\t\t\tdeleteAll.parent().show();\n\t\t\t};\n\n\t\t\tcButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\t// Events for add block dropdown\n\t\t\tdialogCopy = $('#dialog-copy').dialog(defDialog);\n\t\t\t$('#copy-form').find('.layout-action').button().click(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tcopyFrom = $(this).parent().parent().serializeArray();\n\n\t\t\t\tvar fromRoute = copyFrom[0].value;\n\t\t\t\tvar fromStyle = copyFrom[1].value;\n\t\t\t\tvar layoutAction = $(this).data('action');\n\n\t\t\t\tif (fromRoute === '' || (fromRoute ===  config.route && fromStyle === config.style)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (layoutAction === 'copy') {\n\t\t\t\t\tblocksPanel.trigger('click');\n\t\t\t\t\tdialogCopy.dialog({buttons: cButtons}).dialog('open');\n\t\t\t\t} else {\n\t\t\t\t\tvar url = '';\n\n\t\t\t\t\turl += ((fromRoute.substring(0, 1) === '/') ? config.ajaxUrl : config.boardUrl + '/') + fromRoute;\n\t\t\t\t\turl += ((url.indexOf('?') >= 0) ? '&' : '?') + 'style=' + fromStyle + '&edit_mode=1';\n\n\t\t\t\t\twindow.location.href = url;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Events for edit block dialog\n\t\t\tdefDialog.open = function() {\n\t\t\t\tif (dialogEditOpened === false) {\n\t\t\t\t\tvar pane = $(this).dialog('widget').find('.ui-dialog-buttonpane');\n\t\t\t\t\tdialogEditOpened = true;\n\t\t\t\t\t$('<label class=\"dialog-check-button\"><input id=\"update-similar\" type=\"checkbox\" checked=\"checked\" />' + lang.updateSimilar + '</label>').prependTo(pane);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tdialogEdit = $('#dialog-edit').dialog(defDialog).on('click', '.block-class-actions', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tswitch ($(this).data('action')) {\n\t\t\t\t\tcase 'clear':\n\t\t\t\t\t\tdialogEdit.find('#block_class').val('').change();\n\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'toggle':\n\t\t\t\t\t\tdialogEdit.find('#css-class-options').slideToggle();\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}).on('click', '.class-cat', function(e) {\n\t\t\t\tvar id = $(this).attr('href');\n\t\t\t\tvar obj = $('#classes-scroller');\n\t\t\t\tobj.animate({\n\t\t\t\t\tscrollTop: obj.scrollTop() + $(id).position().top\n\t\t\t\t}, 1000);\n\t\t\t\te.preventDefault();\n\t\t\t}).on('click', '.transform', function(e) {\n\t\t\t\tvar classObj = dialogEdit.find('#block_class');\n\t\t\t\tvar classes = classObj.val();\n\t\t\t\tclasses = ((classes) ? classes + ' ' : '') + $(this).text();\n\t\t\t\tclassObj.val(classes).change();\n\t\t\t\te.preventDefault();\n\t\t\t}).on('change', '.block-preview', function() {\n\t\t\t\tpreviewBlock();\n\t\t\t});\n\n\t\t\t// Set default layout\n\t\t\t$('.default-layout').button().click(function(e) {\n\t\t\t\tvar setDefault = $(this).data('set');\n\t\t\t\tsetDefaultLayout(setDefault);\n\t\t\t\te.preventDefault();\n\t\t\t\tif (setDefault === true) {\n\t\t\t\t\t// set as default\n\t\t\t\t\t$(this).parent().hide().next().hide().next().show();\n\t\t\t\t\tdeleteAll.parent().hide();\n\t\t\t\t} else {\n\t\t\t\t\t// remove as default\n\t\t\t\t\t$(this).parent().hide().prev().hide().prev().show();\n\t\t\t\t\tdeleteAll.parent().show();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Set start page\n\t\t\t$('.sm-startpage').button().click(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tvar info = {};\n\t\t\t\tif ($(this).attr('id') === 'set-startpage') {\n\t\t\t\t\t// set as startpage\n\t\t\t\t\t$(this).parent().hide().next().show();\n\t\t\t\t\tinfo = {\n\t\t\t\t\t\tcontroller: $(this).data('controller'),\n\t\t\t\t\t\tmethod: $(this).data('method'),\n\t\t\t\t\t\tparams: $(this).data('params')\n\t\t\t\t\t};\n\t\t\t\t\tsetStartPage(info);\n\t\t\t\t} else {\n\t\t\t\t\t// remove as startpage\n\t\t\t\t\t$(this).parent().hide().prev().show();\n\t\t\t\t\tsetStartPage(info);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tisHidingBlocks = $('#route-settings').submit(function(e) {\n\t\t\t\tsetRoutePrefs($(this));\n\t\t\t\te.preventDefault();\n\t\t\t}).find('#hide_blocks').is(':checked');\n\n\t\t\twindow.onbeforeunload = function(e) {\n\t\t\t\tif (updated === true) {\n\t\t\t\t\te = e || window.event;\n\t\t\t\t\t// For IE and Firefox\n\t\t\t\t\tif (e) {\n\t\t\t\t\t\te.returnValue = lang.leaveConfirm;\n\t\t\t\t\t}\n\t\t\t\t\t// For Safari\n\t\t\t\t\treturn lang.leaveConfirm;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Init Icon Picker\n\t\t\t$('.sitemaker').iconPicker({\n\t\t\t\tselector: '.block-icon',\n\t\t\t\tonSelect: function(item, iconHtml, iconClass) {\n\t\t\t\t\tvar id = item.parentsUntil('.block').parent().attr('id').substring(6);\n\t\t\t\t\tupdateBlock({'id': id, 'icon': iconClass});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tinitTinyMce();\n\t\t}\n\t});\n})(jQuery, window, document);"],"sourceRoot":"/source/"}