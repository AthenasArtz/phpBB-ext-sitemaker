{"version":3,"sources":["blocks/manager.min.js"],"names":["$","window","document","undefined","editorVal","editing","updated","dialogEditOpened","blockPositions","emptyPositionsObj","template","origin","inlineForm","dialogConfirm","dialogEdit","dialogCopy","cButtons","dButtons","eButtons","lButtons","blockObj","blockData","msgObj","saveBtn","lang","config","editMode","phpbb","tinymce","twig","fixPaths","subject","search","replace","RegExp","removeGrid","items","removeClass","matches","this","className","match","join","sortHorizontal","numItems","length","numCols","parent","data","itemsLeft","divisibleItems","hasClass","i","slice","addClass","n","showAllPositions","siblings","hideEmptyPositions","each","pos","last","makeEditable","element","children","trigger","text","show","appendTo","val","focus","select","end","undoEditable","v","hide","renderBlock","id","get","EditorManager","execCommand","html","render","name","find","content","indexOf","eval","saveLayout","blocks","weight","attr","e","bid","substring","position","post","ajaxUrl","route","button","addBlock","posID","blockName","droppedElement","removeAttr","ajaxLoading","block","trim","index","ext","getJSON","result","remove","not","percent","placeCaretAtEnd","el","getSelection","createRange","range","selectNodeContents","collapse","sel","removeAllRanges","addRange","body","createTextRange","textRange","moveToElementText","getEditForm","resp","form","tabs","$this","change","toggleSelectSettings","dialog","buttons","edit","title","setTimeout","getCustomClasses","saveForm","updateSimilar","similar","serializeArray","map","prop","value","encodeURI","list","row","updateBlock","customBlockAction","ajaxCallbacks","callback","call","setDefaultLayout","set","setStartPage","info","param","setRoutePrefs","serialize","copyBlocks","copyFrom","empty","append","processInput","parentsUntil","field","previewBlock","extend","formData","undoPreviewBlock","initTinyMce","init","selector","inline","image_advtab","hidden_input","plugins","toolbar","valid_elements","end_container_on_empty_block","setup","editor","editorPreview","editorContent","on","getContent","format","placeholder","setContent","showMessage","message","fadeIn","delay","fadeOut","showCurrentState","hidingBlocks","positions","hidingPos","ready","boardUrl","style","blocksPanel","exPositions","overPosition","isHidingBlocks","loader","click","toggleClass","prev","toggle","draggable","addClasses","iframeFix","opacity","helper","revert","connectToSortable","start","event","ui","sortable","stop","connectWith","cancel","tolerance","cursor","cursorAt","top","left","item","over","out","isEmptyObject","update","preventDefault","p","addAjaxCallback","next","disabled","mouseleave","exPos","grep","str","styleSelector","ajaxSetup","beforeSend","xhr","settings","url","complete","responseJSON","error","ajaxError","horizontalPos","defDialog","autoOpen","modal","width","deleteAll","dialogDeleteAll","copy","fromRoute","fromStyle","layoutAction","location","href","open","pane","prependTo","action","slideToggle","obj","animate","scrollTop","currClassesLength","space","setDefault","controller","method","params","submit","is","onbeforeunload","returnValue","leaveConfirm","iconPicker","onSelect","iconHtml","iconClass","icon","jQuery"],"mappings":"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","file":"blocks/manager.min.js","sourcesContent":[";(function($, window, document, undefined) {\n\t'use strict';\n\n\tvar editorVal = '';\n\tvar editing = false;\n\tvar updated = false;\n\tvar dialogEditOpened = false;\n\tvar blockPositions = {};\n\tvar emptyPositionsObj = {};\n\tvar template = {};\n\tvar origin = {};\n\tvar inlineForm = {};\n\tvar dialogConfirm = {};\n\tvar dialogEdit = {};\n\tvar dialogCopy = {};\n\tvar cButtons = {};\n\tvar dButtons = {};\n\tvar eButtons = {};\n\tvar lButtons = {};\n\tvar blockObj = {};\n\tvar blockData = {};\n\tvar msgObj = {};\n\tvar saveBtn = {};\n\n\t// These variables are defined in template file\n\tvar lang = {};\n\tvar config = {};\n\tvar editMode = false;\n\n\t// These objects are provided by third-party scripts\n\tvar phpbb = {};\n\tvar tinymce = {};\n\tvar twig = {};\n\n\tvar fixPaths = function(subject) {\n\t\tvar search = (config.ext) ? '.\\/..\\/' : '.\\/..\\/..\\/';\n\t\treturn subject.replace(new RegExp(search, './'));\n\t};\n\n\tvar removeGrid = function(items) {\n\t\titems.removeClass(function() {\n\t\t\tvar matches = this.className.match(/grid__col+(\\S+)?/gi);\n\t\t\treturn (matches) ? matches.join(' ') : '';\n\t\t});\n\t};\n\n\tvar sortHorizontal = function(items) {\n\t\tvar numItems = items.length;\n\t\tvar numCols = (items.parent().data('columns') !== undefined) ? ((items.parent().data('columns') <= 5) ? items.parent().data('columns') : 5) : 3;\n\t\tvar itemsLeft = numItems % numCols;\n\t\tvar divisibleItems = numItems - itemsLeft;\n\n\t\tif (numItems <= numCols) {\n\t\t\tnumCols = numItems;\n\t\t} else if (items.parent().hasClass('equal')) {\n\t\t\tif (itemsLeft > 0 && numCols > 3) {\n\t\t\t\tfor (var i = 1; i < itemsLeft; i++) {\n\t\t\t\t\tif (numItems % (numCols - i) === 0) {\n\t\t\t\t\t\tnumCols = numCols - i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tdivisibleItems = numItems;\n\t\t\titemsLeft = 0;\n\t\t}\n\n\t\tremoveGrid(items);\n\n\t\tif (divisibleItems > 0) {\n\t\t\titems.slice(0, divisibleItems).addClass('grid__col grid__col--1-of-' + numCols);\n\t\t}\n\n\t\tif (itemsLeft) {\n\t\t\tvar n = 1;\n\t\t\tif (itemsLeft < 2) {\n\t\t\t\tn = 5;\n\t\t\t\titemsLeft = 5;\n\t\t\t}\n\t\t\titems.slice(divisibleItems, numItems)\n\t\t\t\t.addClass('grid__col grid__col--' + n + '-of-' + itemsLeft);\n\t\t}\n\t};\n\n\tvar showAllPositions = function() {\n\t\tblockPositions.addClass('show-position');\n\t\temptyPositionsObj.removeClass('empty-position').siblings('.grid__col').removeClass('lastUnit');\n\t};\n\n\tvar hideEmptyPositions = function() {\n\t\tblockPositions.removeClass('show-position');\n\t\temptyPositionsObj = $('.block-position:not(:has(\".block\"))').addClass('empty-position').each(function(i, pos) {\n\t\t\t$(pos).siblings('.grid__col').last().addClass('lastUnit');\n\t\t});\n\t};\n\n\tvar makeEditable = function(element) {\n\t\tif (editing === true) {\n\t\t\tinlineForm.children(':input').trigger('blur');\n\t\t\treturn;\n\t\t}\n\t\tediting = true;\n\t\teditorVal = element.removeClass('editable').text();\n\t\tinlineForm.show().appendTo(element.text('')).children(':input').val(editorVal).focus().select().end();\n\t};\n\n\tvar undoEditable = function(v) {\n\t\tvar element = inlineForm.parent();\n\n\t\tediting = false;\n\t\teditorVal = '';\n\t\telement.addClass('editable').text(v);\n\t\tinlineForm.hide().appendTo($('body'));\n\t};\n\n\tvar renderBlock = function(blockObj, blockData) {\n\t\tvar id = 'block-editor-' + blockData.id;\n\n\t\t// if tinymce editor instance already exists, remove it\n\t\tif (tinymce.get(id)) {\n\t\t\ttinymce.EditorManager.execCommand('mceFocus', false, id);                    \n\t\t\ttinymce.EditorManager.execCommand('mceRemoveEditor', true, id);\n\t\t}\n\n\t\t// update the html\n\t\tblockObj.html(template.render(blockData));\n\n\t\t// if custom block, add editor\n\t\tif (blockData.name === 'blitze.sitemaker.block.custom') {\n\t\t\tif (blockObj.find('#' + id).length) {\n\t\t\t\ttinymce.EditorManager.execCommand('mceAddEditor', false, id);\n\t\t\t} else if (blockData.content.indexOf('script') > -1) {\n\t\t\t\teval(blockObj.find('.sm-block-content').html());\n\t\t\t}\n\t\t}\n\t};\n\n\tvar saveLayout = function() {\n\t\tvar blocks = {};\n\t\t$('.block-position').each(function() {\n\t\t\tvar weight = 0;\n\t\t\tvar pos = $(this).attr('id');\n\t\t\t$(this).find('.block').each(function(i, e) {\n\t\t\t\tvar id = $(e).attr('id');\n\t\t\t\tif (pos !== undefined && id !== undefined) {\n\t\t\t\t\tvar bid = id.substring(6);\n\t\t\t\t\tblocks[bid] = {\n\t\t\t\t\t\t'position': pos.substring(4),\n\t\t\t\t\t\t'weight': weight\n\t\t\t\t\t};\n\t\t\t\t\tweight++;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t$.post(config.ajaxUrl + '/blocks/save_blocks', {route: config.route, blocks: blocks}, function() {\n\t\t\tsaveBtn.button('disable');\n\t\t\tupdated = false;\n\t\t});\n\t};\n\n\tvar addBlock = function(posID, blockName, droppedElement) {\n\t\t$(droppedElement).removeAttr('role aria-disabled data-block class style')\n\t\t\t.addClass('block')\n\t\t\t.html('<div class=\"ui-state-highlight sm-block-spacing sortable\" style=\"padding: 5px\"><i class=\"fa fa-spinner fa-2x fa-spin\"></i> ' + lang.ajaxLoading + '</div>');\n\n\t\tvar data = {\n\t\t\tblock: $.trim(blockName),\n\t\t\tweight: droppedElement.parent().find('.block').index(droppedElement),\n\t\t\troute: config.route,\n\t\t\text: config.ext,\n\t\t\tposition: posID\n\t\t};\n\n\t\t$.getJSON(config.ajaxUrl + '/blocks/add_block', data, function(result) {\n\t\t\tupdated = false;\n\t\t\tif (result.id === '') {\n\t\t\t\t$(droppedElement).remove();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar blockObj = $(droppedElement).attr('id', 'block-' + result.id);\n\n\t\t\trenderBlock(blockObj, result);\n\t\t\tblockObj.children().not('.block-controls')\n\t\t\t\t.show('scale', {percent: 100}, 1000);\n\n\t\t\tif (updated) {\n\t\t\t\tsaveLayout();\n\t\t\t}\n\t\t});\n\t};\n\n\t// Credit: http://stackoverflow.com/questions/4233265/contenteditable-set-caret-at-the-end-of-the-text-cross-browser/4238971#4238971\n\tvar placeCaretAtEnd = function(el) {\n\t\tel.focus();\n\t\tif (typeof window.getSelection !== \"undefined\" && typeof document.createRange !== \"undefined\") {\n\t\t\tvar range = document.createRange();\n\t\t\trange.selectNodeContents(el);\n\t\t\trange.collapse(false);\n\t\t\tvar sel = window.getSelection();\n\t\t\tsel.removeAllRanges();\n\t\t\tsel.addRange(range);\n\t\t} else if (typeof document.body.createTextRange !== \"undefined\") {\n\t\t\tvar textRange = document.body.createTextRange();\n\t\t\ttextRange.moveToElementText(el);\n\t\t\ttextRange.collapse(false);\n\t\t\ttextRange.select();\n\t\t}\n\t};\n\n\tvar getEditForm = function(block) {\n\t\t$.getJSON(config.ajaxUrl + '/blocks/edit_block', {id: block.attr('id').substring(6)}, function(resp) {\n\t\t\tblockData = resp;\n\t\t\tif (resp.form) {\n\t\t\t\tdialogEdit.html(resp.form);\n\t\t\t\tdialogEdit.find('#block-settings').tabs();\n\t\t\t\tdialogEdit.find('select[data-togglable-settings]').each(function() {\n\t\t\t\t\tvar $this = $(this);\n\n\t\t\t\t\t$this.change(function() {\n\t\t\t\t\t\tphpbb.toggleSelectSettings($this);\n\t\t\t\t\t});\n\t\t\t\t\tphpbb.toggleSelectSettings($this);\n\t\t\t\t});\n\t\t\t\tdialogEdit.dialog({buttons: eButtons}).dialog('option', 'title', lang.edit + ' - ' + resp.title).dialog('open');\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tplaceCaretAtEnd(dialogEdit.find('#block_class').get(0));\n\t\t\t\t}, 1000);\n\t\t\t}\n\t\t});\n\t};\n\n\tvar getCustomClasses = function() {\n\t\treturn dialogEdit.find('#block_class').text().trim();\n\t};\n\n\tvar saveForm = function(block) {\n\t\tvar form = $('#edit_form');\n\t\tvar updateSimilar = dialogEdit.dialog('widget').find('#update-similar:checked').length;\n\t\tvar data = {\n\t\t\tid: block.attr('id').substring(6),\n\t\t\troute: config.route,\n\t\t\tsimilar: updateSimilar\n\t\t};\n\n\t\tform.serializeArray().map(function(prop) {\n\t\t\tdata[prop.name] = prop.value;\n\t\t});\n\n\t\tif (data['config[source]']) {\n\t\t\tdata['config[source]'] = encodeURI(data['config[source]']);\n\t\t}\n\n\t\tdata['class'] = getCustomClasses();\n\n\t\tdialogEdit.dialog('close');\n\n\t\t$.post(config.ajaxUrl + '/blocks/save_block', data, function(resp) {\n\t\t\tif (resp.list) {\n\t\t\t\t$.each(resp.list, function(i, row) {\n\t\t\t\t\trow.content = fixPaths(row.content);\n\t\t\t\t\trenderBlock($('#block-' + row.id), row);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\tvar updateBlock = function(data) {\n\t\tif (data.id === undefined) {\n\t\t\treturn false;\n\t\t}\n\t\t$.post(config.ajaxUrl + '/blocks/update_block' + '?route=' + config.route, data, function(resp) {\n\t\t\tif (editing === true) {\n\t\t\t\tundoEditable(resp.title);\n\t\t\t}\n\t\t});\n\t};\n\n\tvar customBlockAction = function(data) {\n\t\tif (data.id === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\t$.post(config.ajaxUrl + '/blocks/handle_custom_action', data, function(resp) {\n\t\t\tif (typeof phpbb.ajaxCallbacks[resp.callback] === 'function') {\n\t\t\t\tphpbb.ajaxCallbacks[resp.callback].call(undefined, resp);\n\t\t\t}\n\t\t});\n\t};\n\n\tvar setDefaultLayout = function(set) {\n\t\t$.post(config.ajaxUrl + '/blocks/set_default_route' + '?route=' + ((set === true) ? config.route : ''));\n\t};\n\n\tvar setStartPage = function(info) {\n\t\t$.post(config.ajaxUrl + '/blocks/set_startpage', $.param(info));\n\t};\n\n\tvar setRoutePrefs = function(form) {\n\t\t$.post(config.ajaxUrl + '/blocks/set_route_prefs' + '?route=' + config.route + '&ext=' + config.ext, form.serialize());\n\t};\n\n\tvar copyBlocks = function(copyFrom) {\n\t\tvar position = $('.block-position');\n\t\t$.getJSON(config.ajaxUrl + '/blocks/copy_route?route=' + config.route + '&ext=' + config.ext + '&' + $.param(copyFrom), function(resp) {\n\t\t\tif (resp.list.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tshowAllPositions();\n\t\t\tposition.empty();\n\n\t\t\t$.each(resp.list, function(position, blocks) {\n\t\t\t\tvar pos = $('#pos-' + position);\n\t\t\t\t$.each(blocks, function(i, row) {\n\t\t\t\t\trow.content = fixPaths(row.content);\n\t\t\t\t\tvar html = template.render(row);\n\n\t\t\t\t\tpos.append('<div id=\"block-' + row.id + '\" class=\"unit size1of1 block\"></div>');\n\t\t\t\t\tpos.find('#block-' + row.id).html(html);\n\t\t\t\t});\n\n\t\t\t\tif (pos.hasClass('horizontal')) {\n\t\t\t\t\tsortHorizontal(pos.find('.block'));\n\t\t\t\t}\n\t\t\t});\n\t\t\thideEmptyPositions();\n\t\t});\n\t};\n\n\tvar processInput = function(e) {\n\t\tif (editing === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar id = $(e).parentsUntil('.block').parent().attr('id').substring(6);\n\t\tvar title = $(e).val();\n\n\t\tif (id && title !== editorVal) {\n\t\t\tupdateBlock({'id': id, 'field': 'title', 'title': title});\n\t\t} else {\n\t\t\tundoEditable(editorVal);\n\t\t}\n\t\treturn false;\n\t};\n\n\tvar previewBlock = function() {\n\t\t// make a copy of block data\n\t\tvar data = $.extend(true, {}, blockData);\n\t\tvar formData = dialogEdit.find('#edit_form').serializeArray();\n\n\t\t$.each(formData, function() {\n\t\t\tdata[this.name] = this.value;\n\t\t});\n\n\t\tdata['class'] = getCustomClasses();\n\n\t\trenderBlock(blockObj, data);\n\t};\n\n\tvar undoPreviewBlock = function() {\n\t\trenderBlock(blockObj, blockData);\n\t};\n\n\tvar initTinyMce = function() {\n\t\ttinymce.init({\n\t\t\t'selector': 'div.editable-block',\n\t\t\t'inline': true,\n\t\t\t'image_advtab': true,\n\t\t\t'hidden_input': false,\n\t\t\t'plugins': [\n\t\t\t\t'advlist autolink lists link image charmap preview hr anchor pagebreak',\n\t\t\t\t'visualblocks visualchars code',\n\t\t\t\t'media nonbreaking save table contextmenu directionality',\n\t\t\t\t'paste textcolor colorpicker textpattern imagetools'\n\t\t\t],\n\t\t\t'toolbar': [\n\t\t\t\t'undo redo | styleselect | bold italic | forecolor backcolor | alignleft aligncenter alignright alignjustify',\n\t\t\t\t'bullist numlist outdent indent | hr pagebreak | image media | link | table | preview code'\n\t\t\t],\n\t\t\t'valid_elements': '*[*]',\n\t\t\t'end_container_on_empty_block': true,\n\t\t\t'setup': function(editor) {\n\t\t\t\tvar editorPreview = '';\n\t\t\t\tvar editorContent = '';\n\t\t\t\teditor.on('blur', function() {\n\t\t\t\t\tvar content = editor.getContent({format: 'raw'});\n\n\t\t\t\t\tif (editor.getContent().length > 0) {\n\t\t\t\t\t\tvar data = $('#' + editor.id).data('raw', content).data();\n\n\t\t\t\t\t\tif (content !== editorContent && content !== lang.placeholder) {\n\t\t\t\t\t\t\tdata.id = editor.id.substring(13);\n\t\t\t\t\t\t\tdata.content = content;\n\n\t\t\t\t\t\t\tcustomBlockAction(data);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\teditor.setContent(editorPreview);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (editorPreview) {\n\t\t\t\t\t\teditor.setContent(editorPreview);\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditor.setContent(lang.placeholder);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\teditor.on('init', function() {\n\t\t\t\t\tif (editor.getContent().length === 0) {\n\t\t\t\t\t\teditor.setContent(lang.placeholder);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\teditor.on('focus', function() {\n\t\t\t\t\teditorContent = $('#' + editor.id).data('raw');\n\t\t\t\t\teditorPreview = editor.getContent({format: 'raw'});\n\t\t\t\t\teditor.setContent(editorContent);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t};\n\n\tvar showMessage = function(message) {\n\t\tif (message) {\n\t\t\tmsgObj.html(message);\n\t\t\tmsgObj.fadeIn().delay(3000).fadeOut();\n\t\t}\n\t};\n\n\tvar showCurrentState = function(hidingBlocks, positions) {\n\t\tif (hidingBlocks) {\n\t\t\tshowMessage('<span><i class=\"fa fa-info-circle fa-blue fa-lg\"></i> ' + lang.hidingBlocks + '</span>');\n\t\t} else if (positions.length) {\n\t\t\tshowMessage('<span><i class=\"fa fa-info-circle fa-blue fa-lg\"></i> ' + lang.hidingPos + ': <strong>' + positions.join(', ') + '</strong></span>');\n\t\t}\n\t};\n\n\t$(document).ready(function() {\n\t\teditMode = window.editMode || false;\n\t\tlang = window.lang || {};\n\t\tphpbb = window.phpbb || {};\n\t\ttinymce = window.tinymce || {};\n\t\ttwig = window.twig || {};\n\t\tconfig = window.config || {\n\t\t\tajaxUrl: '',\n\t\t\tboardUrl: '',\n\t\t\troute: '',\n\t\t\text: '',\n\t\t\tstyle: ''\n\t\t};\n\n\t\tvar copyFrom = '';\n\t\tvar body = {};\n\t\tvar blocksPanel = {};\n\t\tvar exPositions = {};\n\t\tvar overPosition = {};\n\t\tvar isHidingBlocks = false;\n\n\t\tvar loader = $('#admin-bar').show().find('#admin-control').click(function() {\n\t\t\tif (editMode) {\n\t\t\t\t$(this).toggleClass('admin-bar-toggler').prev().toggle();\n\t\t\t\tbody.toggleClass('push-down');\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}).find('i');\n\n\t\tif (editMode) {\n\t\t\tinlineForm = $('<form class=\"inline-form\"><input type=\"text\" class=\"inline-edit\" value=\"\" /></form>').hide().appendTo($('body'));\n\n\t\t\tmsgObj = $('#ajax-message');\n\t\t\temptyPositionsObj = $('.block-position:not(:has(\".block\"))').addClass('empty-position');\n\n\t\t\ttemplate = twig({\n\t\t\t\tdata: $.trim($('#block-template-container').html())\n\t\t\t});\n\n\t\t\t$('#add-block-panel').find('.sitemaker-block').draggable({\n\t\t\t\taddClasses: false,\n\t\t\t\tiframeFix: true,\n\t\t\t\topacity: 0.7,\n\t\t\t\thelper: 'clone',\n\t\t\t\tappendTo: 'body',\n\t\t\t\trevert: 'invalid',\n\t\t\t\tconnectToSortable: '.block-position',\n\t\t\t\tstart: function(event, ui) {\n\t\t\t\t\t$(ui.helper).addClass('dragging');\n\t\t\t\t\tshowAllPositions();\n\t\t\t\t\tblockPositions.sortable('refresh');\n\t\t\t\t\tblocksPanel.trigger('click');\n\t\t\t\t},\n\t\t\t\tstop: function() {\n\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\tif (updated === false) {\n\t\t\t\t\t\t\thideEmptyPositions();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 600);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\texPositions = $('#ex_positions');\n\t\t\tblockPositions = $('.block-position').addClass('block-receiver').sortable({\n\t\t\t\trevert: true,\n\t\t\t\tplaceholder: 'ui-state-highlight grid__col sm-block-spacing block sortable placeholder',\n\t\t\t\tconnectWith: '.block-position',\n\t\t\t\tcancel: '.editable-block, .inline-edit',\n\t\t\t\titems: '.block',\n\t\t\t\ttolerance: 'pointer',\n\t\t\t\tcursor: 'move',\n\t\t\t\tcursorAt: {\n\t\t\t\t\ttop: -10,\n\t\t\t\t\tleft: -10\n\t\t\t\t},\n\t\t\t\tstart: function(event, ui) {\n\t\t\t\t\torigin = $(ui.item).addClass('dragging').parent('.horizontal');\n\t\t\t\t\tshowAllPositions();\n\t\t\t\t\tblockPositions.sortable('refresh');\n\t\t\t\t},\n\t\t\t\tover: function(event, ui) {\n\t\t\t\t\toverPosition = ui.placeholder.parent('.horizontal').children('.block').addClass('sortable');\n\t\t\t\t},\n\t\t\t\tout: function() {\n\t\t\t\t\tif ($.isEmptyObject(overPosition) === false) {\n\t\t\t\t\t\toverPosition.removeClass('sortable');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tupdate: function(event, ui) {\n\t\t\t\t\tupdated = true;\n\t\t\t\t\tif ($(ui.item).attr('id') === undefined) {\n\t\t\t\t\t\tvar posID = $(this).attr('id').substring(4);\n\t\t\t\t\t\tvar blockName = $(ui.item).attr('data-block');\n\t\t\t\t\t\tvar replace = $(this).find('div[data-block=\"' + blockName + '\"]');\n\t\t\t\t\t\taddBlock(posID, blockName, replace);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsaveBtn.button('enable');\n\t\t\t\t\t}\n\n\t\t\t\t\tvar items = $(ui.item).removeAttr('style').parent('.horizontal').children('.block');\n\t\t\t\t\tvar item = $(ui.item);\n\n\t\t\t\t\titem.parent().removeClass('empty-position');\n\t\t\t\t\tremoveGrid(item);\n\n\t\t\t\t\tif (items.length > 0) {\n\t\t\t\t\t\tsortHorizontal(items);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (origin.attr('id') !== $(ui.item).parent('.horizontal').attr('id')) {\n\t\t\t\t\t\tsortHorizontal(origin.find('.block').removeClass('sortable'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstop: function(event, ui) {\n\t\t\t\t\t$(ui.item).removeClass('dragging sortable').removeAttr('style');\n\t\t\t\t\thideEmptyPositions();\n\t\t\t\t\t$('body').trigger('layoutChanged');\n\t\t\t\t}\n\t\t\t}).on('click', '.block-title', function() {\n\t\t\t\tmakeEditable($(this));\n\t\t\t}).on('submit', '.inline-form', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\t$(this).find('.inline-edit').trigger('blur');\n\t\t\t}).on('focusout', '.inline-edit', function() {\n\t\t\t\tprocessInput($(this));\n\t\t\t}).on('click', '.edit-block', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tblockObj = $(this).parentsUntil('.block').parent();\n\t\t\t\tgetEditForm(blockObj);\n\t\t\t}).on('click', '.delete-block', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tblockObj = $(this).parentsUntil('.block').parent();\n\t\t\t\tdialogConfirm.dialog({buttons: dButtons}).dialog('open');\n\t\t\t}).each(function(i, pos) {\n\t\t\t\tvar p = $(pos).attr('id').substring(4);\n\t\t\t\tif (exPositions.find('option[value=' + p + ']').length === 0) {\n\t\t\t\t\texPositions.append('<option value=\"' + p + '\">' + p + '</option>');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tphpbb.addAjaxCallback('previewCustomBlock', function(data) {\n\t\t\t\t$('#block-editor-' + data.id).html(data.content.replace('./../../', ''));\n\t\t\t});\n\n\t\t\tsaveBtn = $('#toggle-edit').button().click(function() {\n\t\t\t\t// exit edit mode\n\t\t\t}).parent().next().children('a').button({disabled: true}).click(function(e) {\n\t\t\t\t// save changes\n\t\t\t\te.preventDefault();\n\t\t\t\tsaveLayout();\n\t\t\t});\n\n\t\t\t$('.has-dropdown').click(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\t$(this).parentsUntil('ul').parent().find('.dropped').not($(this)).removeClass('dropped').next().hide();\n\t\t\t\tblocksPanel = $(this).toggleClass('dropped');\n\t\t\t\tblocksPanel.next().toggle();\n\t\t\t}).next().mouseleave(function() {\n\t\t\t\t//$(this).prev().trigger('click');\n\t\t\t});\n\n\t\t\t$('#admin-options').show(100, function() {\n\t\t\t\tvar exPos = $.grep(exPositions.val(), function(str) {\n\t\t\t\t\treturn str.length;\n\t\t\t\t});\n\t\t\t\tshowCurrentState(isHidingBlocks, exPos);\n\n\t\t\t\t// Thanks KungFuJosh, for this tip\n\t\t\t\tbody = $('body').addClass('push-down');\n\t\t\t});\n\n\t\t\t// Only show style selector if there are other styles\n\t\t\tvar styleSelector = $('#style-options');\n\t\t\tif (styleSelector.find('option').length > 1) {\n\t\t\t\tstyleSelector.show();\n\t\t\t}\n\n\t\t\t$.ajaxSetup({\n\t\t\t\t// add style id to ajax requests\n\t\t\t\t'beforeSend': function(xhr, settings) {\n\t\t\t\t\tloader.addClass('fa-spinner fa-green fa-spin fa-lg fa-pulse');\n\t\t\t\t\tsettings.url += ((settings.url.indexOf('?') < 0) ? '?' : '&') + 'style=' + config.style;\n\t\t\t\t},\n\t\t\t\t'complete': function(data) {\n\t\t\t\t\tloader.delay(2000).removeClass('fa-spinner fa-green fa-spin fa-lg fa-pulse');\n\n\t\t\t\t\tif (data.responseJSON) {\n\t\t\t\t\t\t// Display any returned message\n\t\t\t\t\t\tif (data.responseJSON.message) {\n\t\t\t\t\t\t\tshowMessage(data.responseJSON.message);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Fix relative paths\n\t\t\t\t\t\tif (data.responseJSON.content) {\n\t\t\t\t\t\t\tdata.responseJSON.content = fixPaths(data.responseJSON.content);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t'error': function(event) {\n\t\t\t\t\tshowMessage((event.responseJSON && event.responseJSON.message) ? event.responseJSON.message : lang.ajaxError);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\teButtons[lang.edit] = function() {\n\t\t\t\tsaveForm(blockObj);\n\t\t\t};\n\n\t\t\teButtons[lang.cancel] = function() {\n\t\t\t\tundoPreviewBlock();\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tdButtons[lang.remove] = function() {\n\t\t\t\tvar horizontalPos = blockObj.parent('.horizontal');\n\n\t\t\t\tblockObj.remove();\n\t\t\t\thorizontalPos.find('.ui-effects-placeholder').remove();\n\n\t\t\t\tvar items = horizontalPos.find('.block');\n\n\t\t\t\tif (items.length > 0) {\n\t\t\t\t\tsortHorizontal(items);\n\t\t\t\t}\n\n\t\t\t\thideEmptyPositions();\n\t\t\t\tsaveBtn.button('enable');\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tdButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tvar defDialog = {\n\t\t\t\tautoOpen: false,\n\t\t\t\tmodal: true,\n\t\t\t\twidth: 'auto',\n\t\t\t\tshow: 'slide',\n\t\t\t\thide: 'slide'\n\t\t\t};\n\n\t\t\tdialogConfirm = $('#dialog-confirm').dialog(defDialog);\n\n\t\t\t// Delete all blocks\n\t\t\tlButtons[lang.deleteAll] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t\t$('.block-position').empty();\n\t\t\t\thideEmptyPositions();\n\t\t\t\tsaveBtn.button('enable');\n\t\t\t\tupdated = true;\n\t\t\t};\n\n\t\t\tlButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\tvar dialogDeleteAll = $('#dialog-delete-all').dialog(defDialog);\n\t\t\tvar deleteAll = $('#delete-blocks').button().click(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tdialogDeleteAll.dialog({buttons: lButtons}).dialog('open');\n\t\t\t});\n\n\t\t\t// Initiate dialog for block copy\n\t\t\tcButtons[lang.copy] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t\tcopyBlocks(copyFrom);\n\t\t\t\tdeleteAll.parent().show();\n\t\t\t};\n\n\t\t\tcButtons[lang.cancel] = function() {\n\t\t\t\t$(this).dialog('close');\n\t\t\t};\n\n\t\t\t// Events for add block dropdown\n\t\t\tdialogCopy = $('#dialog-copy').dialog(defDialog);\n\t\t\t$('#copy-form').find('.layout-action').button().click(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tcopyFrom = $(this).parent().parent().serializeArray();\n\n\t\t\t\tvar fromRoute = copyFrom[0].value;\n\t\t\t\tvar fromStyle = copyFrom[1].value;\n\t\t\t\tvar layoutAction = $(this).data('action');\n\n\t\t\t\tif (fromRoute === '' || (fromRoute ===  config.route && fromStyle === config.style)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (layoutAction === 'copy') {\n\t\t\t\t\tblocksPanel.trigger('click');\n\t\t\t\t\tdialogCopy.dialog({buttons: cButtons}).dialog('open');\n\t\t\t\t} else {\n\t\t\t\t\tvar url = '';\n\n\t\t\t\t\turl += ((fromRoute.substring(0, 1) === '/') ? config.ajaxUrl : config.boardUrl + '/') + fromRoute;\n\t\t\t\t\turl += ((url.indexOf('?') >= 0) ? '&' : '?') + 'style=' + fromStyle + '&edit_mode=1';\n\n\t\t\t\t\twindow.location.href = url;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Events for edit block dialog\n\t\t\tdefDialog.open = function() {\n\t\t\t\tif (dialogEditOpened === false) {\n\t\t\t\t\tvar pane = $(this).dialog('widget').find('.ui-dialog-buttonpane');\n\t\t\t\t\tdialogEditOpened = true;\n\t\t\t\t\t$('<label class=\"dialog-check-button\"><input id=\"update-similar\" type=\"checkbox\" />' + lang.updateSimilar + '</label>').prependTo(pane);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tdialogEdit = $('#dialog-edit').dialog(defDialog).on('click', '.block-class-actions', function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tvar action = $(this).data('action');\n\t\t\t\tvar editor = dialogEdit.find('#block_class');\n\t\t\t\tswitch (action) {\n\t\t\t\t\tcase 'clear':\n\t\t\t\t\t\teditor.text('').change();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'toggle':\n\t\t\t\t\t\tdialogEdit.find($(this).attr('href')).slideToggle();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'undo':\n\t\t\t\t\tcase 'redo':\n\t\t\t\t\t\teditor.focus();\n\t\t\t\t\t\tdocument.execCommand(action, false, null);\n\t\t\t\t\t\teditor.change();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}).on('click', '.class-cat', function(e) {\n\t\t\t\tvar id = $(this).attr('href');\n\t\t\t\tvar obj = $('#classes-scroller');\n\t\t\t\tobj.animate({\n\t\t\t\t\tscrollTop: obj.scrollTop() + $(id).position().top\n\t\t\t\t}, 1000);\n\t\t\t\te.preventDefault();\n\t\t\t}).on('click', '.transform', function(e) {\n\t\t\t\tvar editor = dialogEdit.find('#block_class');\n\t\t\t\tvar currClassesLength = editor.text().length;\n\t\t\t\tvar space = currClassesLength ? ' ' : '';\n\t\t\t\tdocument.execCommand('insertText', false, space + $(this).text());\n\t\t\t\teditor.change();\n\t\t\t\te.preventDefault();\n\t\t\t}).on('change', '.block-preview', function() {\n\t\t\t\tpreviewBlock();\n\t\t\t});\n\n\t\t\t// Set default layout\n\t\t\t$('.default-layout').button().click(function(e) {\n\t\t\t\tvar setDefault = $(this).data('set');\n\t\t\t\tsetDefaultLayout(setDefault);\n\t\t\t\te.preventDefault();\n\t\t\t\tif (setDefault === true) {\n\t\t\t\t\t// set as default\n\t\t\t\t\t$(this).parent().hide().next().hide().next().show();\n\t\t\t\t\tdeleteAll.parent().hide();\n\t\t\t\t} else {\n\t\t\t\t\t// remove as default\n\t\t\t\t\t$(this).parent().hide().prev().hide().prev().show();\n\t\t\t\t\tdeleteAll.parent().show();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Set start page\n\t\t\t$('.sm-startpage').button().click(function(e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tvar info = {};\n\t\t\t\tif ($(this).attr('id') === 'set-startpage') {\n\t\t\t\t\t// set as startpage\n\t\t\t\t\t$(this).parent().hide().next().show();\n\t\t\t\t\tinfo = {\n\t\t\t\t\t\tcontroller: $(this).data('controller'),\n\t\t\t\t\t\tmethod: $(this).data('method'),\n\t\t\t\t\t\tparams: $(this).data('params')\n\t\t\t\t\t};\n\t\t\t\t\tsetStartPage(info);\n\t\t\t\t} else {\n\t\t\t\t\t// remove as startpage\n\t\t\t\t\t$(this).parent().hide().prev().show();\n\t\t\t\t\tsetStartPage(info);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tisHidingBlocks = $('#route-settings').submit(function(e) {\n\t\t\t\tsetRoutePrefs($(this));\n\t\t\t\te.preventDefault();\n\t\t\t}).find('#hide_blocks').is(':checked');\n\n\t\t\twindow.onbeforeunload = function(e) {\n\t\t\t\tif (updated === true) {\n\t\t\t\t\te = e || window.event;\n\t\t\t\t\t// For IE and Firefox\n\t\t\t\t\tif (e) {\n\t\t\t\t\t\te.returnValue = lang.leaveConfirm;\n\t\t\t\t\t}\n\t\t\t\t\t// For Safari\n\t\t\t\t\treturn lang.leaveConfirm;\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Init Icon Picker\n\t\t\t$('.sitemaker').iconPicker({\n\t\t\t\tselector: '.block-icon',\n\t\t\t\tonSelect: function(item, iconHtml, iconClass) {\n\t\t\t\t\tvar id = item.parentsUntil('.block').parent().attr('id').substring(6);\n\t\t\t\t\tupdateBlock({'id': id, 'icon': iconClass});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tinitTinyMce();\n\t\t}\n\t});\n})(jQuery, window, document);"],"sourceRoot":"/source/"}